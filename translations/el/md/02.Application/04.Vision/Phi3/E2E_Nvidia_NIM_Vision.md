### Παράδειγμα Σεναρίου

Φανταστείτε ότι έχετε μια εικόνα (`demo.png`) και θέλετε να δημιουργήσετε Python κώδικα που επεξεργάζεται αυτή την εικόνα και αποθηκεύει μια νέα εκδοχή της (`phi-3-vision.jpg`).

Ο παραπάνω κώδικας αυτοματοποιεί αυτή τη διαδικασία με:

1. Τη ρύθμιση του περιβάλλοντος και των απαραίτητων ρυθμίσεων.
2. Τη δημιουργία ενός προτροπής που καθοδηγεί το μοντέλο να δημιουργήσει τον απαιτούμενο Python κώδικα.
3. Την αποστολή της προτροπής στο μοντέλο και τη συλλογή του παραγόμενου κώδικα.
4. Την εξαγωγή και την εκτέλεση του παραγόμενου κώδικα.
5. Την εμφάνιση της αρχικής και της επεξεργασμένης εικόνας.

Αυτή η προσέγγιση αξιοποιεί τη δύναμη της τεχνητής νοημοσύνης για την αυτοματοποίηση εργασιών επεξεργασίας εικόνας, καθιστώντας τις πιο εύκολες και γρήγορες.

[Δείγμα Λύσης Κώδικα](../../../../../../code/06.E2E/E2E_Nvidia_NIM_Phi3_Vision.ipynb)

Ας αναλύσουμε τι κάνει ολόκληρος ο κώδικας βήμα προς βήμα:

1. **Εγκατάσταση Απαιτούμενου Πακέτου**:
    ```python
    !pip install langchain_nvidia_ai_endpoints -U
    ```
    Αυτή η εντολή εγκαθιστά το πακέτο `langchain_nvidia_ai_endpoints`, διασφαλίζοντας ότι είναι η πιο πρόσφατη έκδοση.

2. **Εισαγωγή Απαραίτητων Μονάδων**:
    ```python
    from langchain_nvidia_ai_endpoints import ChatNVIDIA
    import getpass
    import os
    import base64
    ```
    Αυτές οι εισαγωγές φέρνουν τις απαραίτητες μονάδες για την αλληλεπίδραση με τα NVIDIA AI endpoints, την ασφαλή διαχείριση κωδικών πρόσβασης, την αλληλεπίδραση με το λειτουργικό σύστημα και την κωδικοποίηση/αποκωδικοποίηση δεδομένων σε μορφή base64.

3. **Ρύθμιση API Key**:
    ```python
    if not os.getenv("NVIDIA_API_KEY"):
        os.environ["NVIDIA_API_KEY"] = getpass.getpass("Enter your NVIDIA API key: ")
    ```
    Αυτός ο κώδικας ελέγχει αν έχει οριστεί η μεταβλητή περιβάλλοντος `NVIDIA_API_KEY`. Αν όχι, ζητά από τον χρήστη να εισάγει το API key με ασφάλεια.

4. **Ορισμός Μοντέλου και Διαδρομής Εικόνας**:
    ```python
    model = 'microsoft/phi-3-vision-128k-instruct'
    chat = ChatNVIDIA(model=model)
    img_path = './imgs/demo.png'
    ```
    Αυτό ορίζει το μοντέλο που θα χρησιμοποιηθεί, δημιουργεί μια παρουσία του `ChatNVIDIA` με το συγκεκριμένο μοντέλο και καθορίζει τη διαδρομή του αρχείου εικόνας.

5. **Δημιουργία Προτροπής Κειμένου**:
    ```python
    text = "Please create Python code for image, and use plt to save the new picture under imgs/ and name it phi-3-vision.jpg."
    ```
    Αυτό ορίζει μια προτροπή κειμένου που καθοδηγεί το μοντέλο να δημιουργήσει Python κώδικα για την επεξεργασία μιας εικόνας.

6. **Κωδικοποίηση Εικόνας σε Base64**:
    ```python
    with open(img_path, "rb") as f:
        image_b64 = base64.b64encode(f.read()).decode()
    image = f'<img src="data:image/png;base64,{image_b64}" />'
    ```
    Αυτός ο κώδικας διαβάζει το αρχείο εικόνας, το κωδικοποιεί σε base64 και δημιουργεί μια ετικέτα HTML εικόνας με τα κωδικοποιημένα δεδομένα.

7. **Συνδυασμός Κειμένου και Εικόνας σε Προτροπή**:
    ```python
    prompt = f"{text} {image}"
    ```
    Αυτό συνδυάζει την προτροπή κειμένου και την ετικέτα HTML εικόνας σε ένα ενιαίο string.

8. **Δημιουργία Κώδικα με Χρήση του ChatNVIDIA**:
    ```python
    code = ""
    for chunk in chat.stream(prompt):
        print(chunk.content, end="")
        code += chunk.content
    ```
    Αυτός ο κώδικας στέλνει την προτροπή στο `ChatNVIDIA` model and collects the generated code in chunks, printing and appending each chunk to the `code` string.

9. **Εξαγωγή Python Κώδικα από το Παραγόμενο Περιεχόμενο**:
    ```python
    begin = code.index('```python') + 9
    code = code[begin:]
    end = code.index('```')
    code = code[:end]
    ```
    Αυτό εξάγει τον πραγματικό Python κώδικα από το παραγόμενο περιεχόμενο αφαιρώντας τη μορφοποίηση markdown.

10. **Εκτέλεση του Παραγόμενου Κώδικα**:
    ```python
    import subprocess
    result = subprocess.run(["python", "-c", code], capture_output=True)
    ```
    Αυτό εκτελεί τον εξαγόμενο Python κώδικα ως υποδιαδικασία και καταγράφει την έξοδό του.

11. **Εμφάνιση Εικόνων**:
    ```python
    from IPython.display import Image, display
    display(Image(filename='./imgs/phi-3-vision.jpg'))
    display(Image(filename='./imgs/demo.png'))
    ```
    Αυτές οι γραμμές εμφανίζουν τις εικόνες χρησιμοποιώντας τη μονάδα `IPython.display`.

**Αποποίηση Ευθύνης**:  
Αυτό το έγγραφο έχει μεταφραστεί χρησιμοποιώντας υπηρεσίες μηχανικής μετάφρασης βασισμένες σε τεχνητή νοημοσύνη. Παρόλο που καταβάλλουμε προσπάθειες για ακρίβεια, παρακαλούμε να έχετε υπόψη ότι οι αυτοματοποιημένες μεταφράσεις ενδέχεται να περιέχουν λάθη ή ανακρίβειες. Το αρχικό έγγραφο στη μητρική του γλώσσα θα πρέπει να θεωρείται η αυθεντική πηγή. Για κρίσιμες πληροφορίες, συνιστάται επαγγελματική ανθρώπινη μετάφραση. Δεν φέρουμε ευθύνη για τυχόν παρεξηγήσεις ή λανθασμένες ερμηνείες που προκύπτουν από τη χρήση αυτής της μετάφρασης.