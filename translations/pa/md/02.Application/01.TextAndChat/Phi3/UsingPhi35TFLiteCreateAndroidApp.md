# **риори╛риИриХри░рйЛри╕ри╛рилриЯ Phi-3.5 tflite рижрйА ри╡ри░ридрйЛриВ риХри░риХрйЗ риРриВрибри░ри╛риЗриб риРрик римригри╛риЙригри╛**

риЗри╣ риори╛риИриХри░рйЛри╕ри╛рилриЯ Phi-3.5 tflite риори╛рибри▓ри╛риВ рижрйА ри╡ри░ридрйЛриВ риХри░рижрйЗ ри╣рйЛриП риЗрй▒риХ риРриВрибри░ри╛риЗриб ри╕рйИриВрикри▓ ри╣рйИред

## **ЁЯУЪ риЧри┐риЖрии**

риРриВрибри░ри╛риЗриб LLM риЗрй░рилри░рйИриВри╕ API ридрйБри╣ри╛риирйВрй░ риРриВрибри░ри╛риЗриб риРрикри▓рйАриХрйЗри╕ри╝рии ри▓риИ ри╡рй▒рибрйЗ ринри╛ри╕ри╝ри╛ риори╛рибри▓ (LLMs) риирйВрй░ рикрйВри░рйА ридри░рйНри╣ри╛риВ рибри┐ри╡ри╛риИри╕ 'ридрйЗ риЪри▓ри╛риЙриг рижрйА риЖриЧри┐риЖ рижри┐рй░рижри╛ ри╣рйИред риЗри╕ риири╛ри▓ ридрйБри╕рйАриВ ри╡рй▒риЦ-ри╡рй▒риЦ риХрй░рио риХри░ ри╕риХрижрйЗ ри╣рйЛ, риЬри┐ри╡рйЗриВ риХри┐ риЯрйИриХри╕риЯ риЬриири░рйЗриЯ риХри░риири╛, риХрйБрижри░ридрйА ринри╛ри╕ри╝ри╛ ри░рйВрик ри╡ри┐рй▒риЪ риЬри╛ригриХри╛ри░рйА рикрйНри░ри╛рикрид риХри░риири╛ риЕридрйЗ рижри╕ридри╛ри╡рйЗриЬри╝ри╛риВ рижри╛ ри╕ри╛ри░ ри▓ри┐риЦригри╛ред риЗри╣ риЯри╛ри╕риХ риХриИ риЯрйИриХри╕риЯ-риЯрйВ-риЯрйИриХри╕риЯ ри╡рй▒рибрйЗ ринри╛ри╕ри╝ри╛ риори╛рибри▓ри╛риВ ри▓риИ римри┐ри▓риЯ-риЗрии ри╕рикрйЛри░риЯ рикрйНри░рижри╛рии риХри░рижри╛ ри╣рйИ, ридри╛риВ риЬрйЛ ридрйБри╕рйАриВ риЖрикригрйЗ риРриВрибри░ри╛риЗриб риРрикри╕ ри▓риИ ридри╛риЬри╝ри╛ риЬриири░рйЗриЯри┐ри╡ AI риори╛рибри▓ри╛риВ риирйВрй░ ри▓ри╛риЧрйВ риХри░ ри╕риХрйЛред

риЧрйВриЧри▓ AI Edge Torch риЗрй▒риХ рикри╛риЗриерии ри▓ри╛риЗримрйНри░рйЗри░рйА ри╣рйИ риЬрйЛ PyTorch риори╛рибри▓ри╛риВ риирйВрй░ .tflite рилри╛ри░риорйИриЯ ри╡ри┐рй▒риЪ риХриири╡ри░риЯ риХри░рии ри▓риИ ри╕ри╣ри╛риЗридри╛ риХри░рижрйА ри╣рйИред риЗри╣ риори╛рибри▓ рилри┐ри░ TensorFlow Lite риЕридрйЗ MediaPipe риири╛ри▓ риЪри▓ ри╕риХрижрйЗ ри╣рииред риЗри╣ риРриВрибри░ри╛риЗриб, iOS риЕридрйЗ IoT ри▓риИ риРрикри▓рйАриХрйЗри╕ри╝риири╛риВ риирйВрй░ ри╕риори░риерии рижри┐рй░рижри╛ ри╣рйИ риЬрйЛ рикрйВри░рйА ридри░рйНри╣ри╛риВ рибри┐ри╡ри╛риИри╕ 'ридрйЗ риори╛рибри▓ риЪри▓ри╛ ри╕риХрижрйЗ ри╣рииред AI Edge Torch ри╡ри┐ри╕ридрйНри░ри┐рид CPU риХри╡ри░рйЗриЬ рикрйНри░рижри╛рии риХри░рижри╛ ри╣рйИ, риЬри┐ри╕ ри╡ри┐рй▒риЪ ри╕ри╝рйБри░рйВриЖридрйА GPU риЕридрйЗ NPU ри╕рикрйЛри░риЯ ри╕ри╝ри╛риори▓ ри╣рйИред AI Edge Torch PyTorch риири╛ри▓ риириЬри╝рижрйАриХрйА риЗриХрйАриХри░рии рижри╛ риЙрижрйЗри╕ри╝ ри░рй▒риЦрижри╛ ри╣рйИ, torch.export() 'ридрйЗ риЕризри╛ри░ри┐рид ри╣рйИ риЕридрйЗ Core ATen риЖрикри░рйЗриЯри░ри╛риВ рижрйА риЪрй░риЧрйА риХри╡ри░рйЗриЬ рижри┐рй░рижри╛ ри╣рйИред

## **ЁЯкм риори╛ри░риЧрижри░ри╕ри╝рии**

### **ЁЯФе риори╛риИриХри░рйЛри╕ри╛рилриЯ Phi-3.5 риирйВрй░ tflite ри╕рикрйЛри░риЯ ри╡ри┐рй▒риЪ риХриири╡ри░риЯ риХри░рйЛ**

0. риЗри╣ ри╕рйИриВрикри▓ риРриВрибри░ри╛риЗриб 14+ ри▓риИ ри╣рйИред

1. Python 3.10.12 риЗрй░ри╕риЯри╛ри▓ риХри░рйЛ

***ри╕рйБриЭри╛риЕ:*** риЖрикригрйЗ рикри╛риЗриерии риРриири╡ри╛риЗри░риириорйИриВриЯ ри▓риИ conda рижрйА ри╡ри░ридрйЛриВ риХри░рйЛ

2. Ubuntu 20.04 / 22.04 (риХри┐ри░рикри╛ риХри░риХрйЗ [google ai-edge-torch](https://github.com/google-ai-edge/ai-edge-torch) 'ридрйЗ ризри┐риЖрии рижрйЗри╡рйЛ)

***ри╕рйБриЭри╛риЕ:*** риЖрикригрйЗ риРриири╡ри╛риЗри░риириорйИриВриЯ риирйВрй░ римригри╛риЙриг ри▓риИ Azure Linux VM риЬри╛риВ 3rd party риХри▓ри╛риЙриб VM рижрйА ри╡ри░ридрйЛриВ риХри░рйЛ

3. риЖрикригрйЗ Linux bash 'ридрйЗ риЬри╛риУ, Python ри▓ри╛риЗримрйНри░рйЗри░рйА риЗрй░ри╕риЯри╛ри▓ риХри░рии ри▓риИ

```bash

git clone https://github.com/google-ai-edge/ai-edge-torch.git

cd ai-edge-torch

pip install -r requirements.txt -U 

pip install tensorflow-cpu -U

pip install -e .

```

4. Hugging Face ридрйЛриВ Microsoft-3.5-Instruct рибри╛риКриири▓рйЛриб риХри░рйЛ

```bash

git lfs install

git clone  https://huggingface.co/microsoft/Phi-3.5-mini-instruct

```

5. риори╛риИриХри░рйЛри╕ри╛рилриЯ Phi-3.5 риирйВрй░ tflite ри╡ри┐рй▒риЪ риХриири╡ри░риЯ риХри░рйЛ

```bash

python ai-edge-torch/ai_edge_torch/generative/examples/phi/convert_phi3_to_tflite.py --checkpoint_path  Your Microsoft Phi-3.5-mini-instruct path --tflite_path Your Microsoft Phi-3.5-mini-instruct tflite path  --prefill_seq_len 1024 --kv_cache_max_len 1280 --quantize True

```

### **ЁЯФе риори╛риИриХри░рйЛри╕ри╛рилриЯ Phi-3.5 риирйВрй░ риРриВрибри░ри╛риЗриб Mediapipe римрй░рибри▓ ри╡ри┐рй▒риЪ риХриири╡ри░риЯ риХри░рйЛ**

риХри┐ри░рикри╛ риХри░риХрйЗ рикри╣ри┐ри▓ри╛риВ mediapipe риЗрй░ри╕риЯри╛ри▓ риХри░рйЛ

```bash

pip install mediapipe

```

риЗри╣ риХрйЛриб риЖрикригрйЗ [риирйЛриЯримрйБрй▒риХ](../../../../../../code/09.UpdateSamples/Aug/Android/convert/convert_phi.ipynb) ри╡ри┐рй▒риЪ риЪри▓ри╛риУ

```python

import mediapipe as mp
from mediapipe.tasks.python.genai import bundler

config = bundler.BundleConfig(
    tflite_model='Your Phi-3.5 tflite model path',
    tokenizer_model='Your Phi-3.5 tokenizer model path',
    start_token='start_token',
    stop_tokens=[STOP_TOKENS],
    output_filename='Your Phi-3.5 task model path',
    enable_bytes_to_unicode_mapping=True or Flase,
)
bundler.create_bundle(config)

```

### **ЁЯФе риЖрикригрйЗ риРриВрибри░ри╛риЗриб рибри┐ри╡ри╛риИри╕ рижрйЗ рикри╛рие ри╡ри┐рй▒риЪ риори╛рибри▓ риирйВрй░ adb push риХри░риири╛**

```bash

adb shell rm -r /data/local/tmp/llm/ # Remove any previously loaded models

adb shell mkdir -p /data/local/tmp/llm/

adb push 'Your Phi-3.5 task model path' /data/local/tmp/llm/phi3.task

```

### **ЁЯФе риЖрикригри╛ риРриВрибри░ри╛риЗриб риХрйЛриб риЪри▓ри╛риЙригри╛**

![рибрйИриорйЛ](../../../../../../translated_images/demo.8981711efb5a9cee5dcd835f66b3b31b94b4f3e527300e15a98a0d48863b9fbd.pa.png)

**риЕри╕ри╡рйАриХри░ридрйА**:  
риЗри╣ рижри╕ридри╛ри╡рйЗриЬри╝ риори╕ри╝рйАрии-риЕризри╛ри░ри┐рид AI риЕриирйБри╡ри╛риж ри╕рйЗри╡ри╛ри╡ри╛риВ рижрйА ри╡ри░ридрйЛриВ риХри░риХрйЗ риЕриирйБри╡ри╛рижри┐рид риХрйАридри╛ риЧри┐риЖ ри╣рйИред риЬрижрйЛриВ риХри┐ риЕри╕рйАриВ ри╕ри╣рйА ри╣рйЛриг рижрйА риХрйЛри╕ри╝ри┐ри╕ри╝ риХри░рижрйЗ ри╣ри╛риВ, риХри┐ри░рикри╛ риХри░риХрйЗ ризри┐риЖрии ри╡ри┐рй▒риЪ ри░рй▒риЦрйЛ риХри┐ ри╕ри╡рйИриЪри╛ри▓ри┐рид риЕриирйБри╡ри╛рижри╛риВ ри╡ри┐рй▒риЪ риЧри▓ридрйАриЖриВ риЬри╛риВ риЕри╕рйБриЪрй▒риЬрйЗ рикрй▒риЦ ри╣рйЛ ри╕риХрижрйЗ ри╣рииред риорйВри▓ рижри╕ридри╛ри╡рйЗриЬри╝ риирйВрй░ риЙри╕рижрйА риорйВри▓ ринри╛ри╕ри╝ри╛ ри╡ри┐рй▒риЪ рикрйНри░риори╛ригри┐риХ ри╕ри░рйЛрид риорй░риири┐риЖ риЬри╛ригри╛ риЪри╛ри╣рйАрижри╛ ри╣рйИред риори╣рй▒ридри╡рикрйВри░рии риЬри╛ригриХри╛ри░рйА ри▓риИ, рикрйЗри╕ри╝рйЗри╡ри░ риориирйБрй▒риЦрйА риЕриирйБри╡ри╛риж рижрйА ри╕ри┐рилри╛ри░ри╕ри╝ риХрйАридрйА риЬри╛риВрижрйА ри╣рйИред риЗри╕ риЕриирйБри╡ри╛риж рижрйА ри╡ри░ридрйЛриВ ридрйЛриВ рикрйИрижри╛ ри╣рйЛриг ри╡ри╛ри▓рйЗ риХри┐ри╕рйЗ ри╡рйА риЧри▓рид рилри╣ри┐риорйАриЖриВ риЬри╛риВ риЧри▓рид ри╡ри┐риЖриЦри┐риЖри╡ри╛риВ ри▓риИ риЕри╕рйАриВ риЬри╝ри┐рй░риорйЗри╡ри╛ри░ риири╣рйАриВ ри╣ри╛риВред