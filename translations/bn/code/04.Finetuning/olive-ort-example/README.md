# Olive ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ Phi3 ржлрж╛ржЗржи-ржЯрж┐ржЙржи ржХрж░рзБржи

ржПржЗ ржЙржжрж╛рж╣рж░ржгрзЗ ржЖржкржирж┐ Olive ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржирж┐ржорзНржирж▓рж┐ржЦрж┐ржд ржХрж╛ржЬржЧрзБрж▓рзЛ ржХрж░ржмрзЗржи:

1. ржПржХржЯрж┐ LoRA ржЕрзНржпрж╛ржбрж╛ржкрзНржЯрж╛рж░ ржлрж╛ржЗржи-ржЯрж┐ржЙржи ржХрж░рзЗ ржмрж╛ржХрзНржпржЧрзБрж▓рзЛржХрзЗ Sad, Joy, Fear, Surprise рж╢рзНрж░рзЗржгрж┐рждрзЗ рж╢рзНрж░рзЗржгрж┐ржмржжрзНржз ржХрж░ржмрзЗржиред
1. ржЕрзНржпрж╛ржбрж╛ржкрзНржЯрж╛рж░ ржУржЬржиржЧрзБрж▓рзЛ ржмрзЗрж╕ ржоржбрзЗрж▓рзЗрж░ рж╕рж╛ржерзЗ ржорж╛рж░рзНржЬ ржХрж░ржмрзЗржиред
1. ржоржбрзЗрж▓ржЯрж┐ржХрзЗ `int4`-ржП ржЕржкрзНржЯрж┐ржорж╛ржЗржЬ ржПржмржВ ржХрзЛржпрж╝рж╛ржирзНржЯрж╛ржЗржЬ ржХрж░ржмрзЗржиред

ржЖржорж░рж╛ ржЖржкржирж╛ржХрзЗ ONNX Runtime (ORT) Generate API ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржлрж╛ржЗржи-ржЯрж┐ржЙржи ржХрж░рж╛ ржоржбрзЗрж▓ржЯрж┐ ржХрж┐ржнрж╛ржмрзЗ ржЗржиржлрж╛рж░рзЗржирзНрж╕ ржХрж░ржмрзЗржи рждрж╛ржУ ржжрзЗржЦрж╛ржмрзЛред

> **тЪая╕П ржлрж╛ржЗржи-ржЯрж┐ржЙржирж┐ржВржпрж╝рзЗрж░ ржЬржирзНржп, ржПржХржЯрж┐ ржЙржкржпрзБржХрзНржд GPU ржерж╛ржХрж╛ ржкрзНрж░ржпрж╝рзЛржЬржи - ржпрзЗржоржи A10, V100, A100ред**

## ЁЯТ╛ ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи

ржПржХржЯрж┐ ржирждрзБржи Python ржнрж╛рж░рзНржЪрзБржпрж╝рж╛рж▓ ржПржиржнрж╛ржпрж╝рж░ржиржорзЗржирзНржЯ рждрзИрж░рж┐ ржХрж░рзБржи (ржЙржжрж╛рж╣рж░ржгрж╕рзНржмрж░рзВржк, `conda` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ):

```bash
conda create -n olive-ai python=3.11
conda activate olive-ai
```

ржПрж░ржкрж░, Olive ржПржмржВ ржлрж╛ржЗржи-ржЯрж┐ржЙржирж┐ржВ ржУржпрж╝рж╛рж░рзНржХржлрзНрж▓рзЛрж░ ржЬржирзНржп ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ ржбрж┐ржкрзЗржиржбрзЗржирзНрж╕рж┐ ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи:

```bash
cd Phi-3CookBook/code/04.Finetuning/olive-ort-example
pip install olive-ai[gpu]
pip install -r requirements.txt
```

## ЁЯзк Olive ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ Phi3 ржлрж╛ржЗржи-ржЯрж┐ржЙржи ржХрж░рзБржи
[Olive ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржлрж╛ржЗрж▓](../../../../../code/04.Finetuning/olive-ort-example/phrase-classification.json) ржПржХржЯрж┐ *ржУржпрж╝рж╛рж░рзНржХржлрзНрж▓рзЛ* ржзрж╛рж░ржг ржХрж░рзЗ ржпрж╛ ржирж┐ржорзНржирж▓рж┐ржЦрж┐ржд *ржкрж╛рж╕* ржирж┐ржпрж╝рзЗ ржЧржарж┐ржд:

Phi3 -> LoRA -> MergeAdapterWeights -> ModelBuilder

ржЙржЪрзНржЪ-рж╕рзНрждрж░рзЗ, ржПржЗ ржУржпрж╝рж╛рж░рзНржХржлрзНрж▓рзЛржЯрж┐ ржХрж░ржмрзЗ:

1. Phi3 ржлрж╛ржЗржи-ржЯрж┐ржЙржи ржХрж░ржмрзЗ (рззрзлрзж ржзрж╛ржкрзЗрж░ ржЬржирзНржп, ржпрж╛ ржЖржкржирж┐ ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рждрзЗ ржкрж╛рж░рзЗржи) [dataset/data-classification.json](../../../../../code/04.Finetuning/olive-ort-example/dataset/dataset-classification.json) ржбрзЗржЯрж╛ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗред
1. LoRA ржЕрзНржпрж╛ржбрж╛ржкрзНржЯрж╛рж░ ржУржЬржиржЧрзБрж▓рзЛ ржмрзЗрж╕ ржоржбрзЗрж▓рзЗрж░ рж╕рж╛ржерзЗ ржорж╛рж░рзНржЬ ржХрж░ржмрзЗред ржПрж░ ржлрж▓рзЗ ржЖржкржирж┐ ONNX ржлрж░ржорзНржпрж╛ржЯрзЗ ржПржХржЯрж┐ ржПржХржХ ржоржбрзЗрж▓ ржЖрж░рзНржЯрж┐ржлрзНржпрж╛ржХрзНржЯ ржкрж╛ржмрзЗржиред
1. Model Builder ржоржбрзЗрж▓ржЯрж┐ржХрзЗ ONNX runtime-ржПрж░ ржЬржирзНржп ржЕржкрзНржЯрж┐ржорж╛ржЗржЬ ржХрж░ржмрзЗ *ржПржмржВ* `int4`-ржП ржХрзЛржпрж╝рж╛ржирзНржЯрж╛ржЗржЬ ржХрж░ржмрзЗред

ржУржпрж╝рж╛рж░рзНржХржлрзНрж▓рзЛржЯрж┐ ржЪрж╛рж▓рж╛ржирзЛрж░ ржЬржирзНржп, рж░рж╛ржи ржХрж░рзБржи:

```bash
olive run --config phrase-classification.json
```

Olive ржХрж╛ржЬ рж╢рзЗрж╖ ржХрж░рж▓рзЗ, ржЕржкрзНржЯрж┐ржорж╛ржЗржЬ ржХрж░рж╛ `int4` ржлрж╛ржЗржи-ржЯрж┐ржЙржи ржХрж░рж╛ Phi3 ржоржбрзЗрж▓ржЯрж┐ ржПржЦрж╛ржирзЗ ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржмрзЗ: `code/04.Finetuning/olive-ort-example/models/lora-merge-mb/gpu-cuda_model`ред

## ЁЯзСтАНЁЯТ╗ ржЖржкржирж╛рж░ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржирзЗ ржлрж╛ржЗржи-ржЯрж┐ржЙржи ржХрж░рж╛ Phi3 ржЗржирзНржЯрж┐ржЧрзНрж░рзЗржЯ ржХрж░рзБржи 

ржЕрзНржпрж╛ржк ржЪрж╛рж▓рж╛ржирзЛрж░ ржЬржирзНржп:

```bash
python app/app.py --phrase "cricket is a wonderful sport!" --model-path models/lora-merge-mb/gpu-cuda_model
```

ржПржЗ рж░рзЗрж╕ржкржирзНрж╕ржЯрж┐ ржмрж╛ржХрзНржпрзЗрж░ ржПржХржХ рж╢ржмрзНржжрзЗрж░ рж╢рзНрж░рзЗржгрж┐ржмрж┐ржирзНржпрж╛рж╕ рж╣ржУржпрж╝рж╛ ржЙржЪрж┐ржд (Sad/Joy/Fear/Surprise)ред

**ржЕрж╕рзНржмрзАржХрзГрждрж┐**:  
ржПржЗ ржиржерж┐ ржорзЗрж╢рж┐ржи-ржнрж┐рждрзНрждрж┐ржХ ржПржЖржЗ ржЕржирзБржмрж╛ржж ржкрж░рж┐рж╖рзЗржмрж╛рж░ ржорж╛ржзрзНржпржорзЗ ржЕржирзБржмрж╛ржж ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗред ржЖржорж░рж╛ ржпржерж╛рж╕рж╛ржзрзНржп рж╕ржарж┐ржХрждрж╛ ржмржЬрж╛ржпрж╝ рж░рж╛ржЦрж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рж┐, рждржмрзЗ ржжржпрж╝рж╛ ржХрж░рзЗ ржоржирзЗ рж░рж╛ржЦржмрзЗржи ржпрзЗ рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ ржЕржирзБржмрж╛ржжрзЗ рждрзНрж░рзБржЯрж┐ ржмрж╛ ржЕрж╕ржЩрзНржЧрждрж┐ ржерж╛ржХрждрзЗ ржкрж╛рж░рзЗред ржПрж░ ржорзВрж▓ ржнрж╛рж╖рж╛ржпрж╝ ржерж╛ржХрж╛ ржЖрж╕рж▓ ржиржерж┐ржЯрж┐ржХрзЗржЗ ржкрзНрж░рж╛ржорж╛ржгрж┐ржХ ржЙрзОрж╕ рж╣рж┐рж╕рж╛ржмрзЗ ржмрж┐ржмрзЗржЪржирж╛ ржХрж░рж╛ ржЙржЪрж┐рждред ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг рждржерзНржпрзЗрж░ ржЬржирзНржп, ржкрзЗрж╢рж╛ржжрж╛рж░ ржорж╛ржиржм ржЕржирзБржмрж╛ржжрзЗрж░ ржкрж░рж╛ржорж░рзНрж╢ ржжрзЗржУржпрж╝рж╛ рж╣ржпрж╝ред ржПржЗ ржЕржирзБржмрж╛ржж ржмрзНржпржмрж╣рж╛рж░рзЗрж░ ржлрж▓рзЗ ржЙржжрзНржнрзВржд ржХрзЛржирзЛ ржнрзБрж▓ ржмрзЛржЭрж╛ржмрзБржЭрж┐ ржмрж╛ ржнрзБрж▓ ржмрзНржпрж╛ржЦрзНржпрж╛рж░ ржЬржирзНржп ржЖржорж░рж╛ ржжрж╛ржпрж╝рзА ржиржЗред