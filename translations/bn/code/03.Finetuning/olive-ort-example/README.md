# Olive ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ Phi3 ржлрж╛ржЗржи-ржЯрж┐ржЙржи ржХрж░рзБржи

ржПржЗ ржЙржжрж╛рж╣рж░ржгрзЗ ржЖржкржирж┐ Olive ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржХрж░ржмрзЗржи:

1. ржПржХржЯрж┐ LoRA ржЕрзНржпрж╛ржбрж╛ржкрзНржЯрж╛рж░ ржлрж╛ржЗржи-ржЯрж┐ржЙржи ржХрж░рзЗ ржмрж╛ржХрзНржпржЧрзБрж▓рзЛржХрзЗ Sad, Joy, Fear, Surprise ржХрзНржпрж╛ржЯрзЗржЧрж░рж┐рждрзЗ рж╢рзНрж░рзЗржгрж┐ржмржжрзНржз ржХрж░рж╛ред
1. ржЕрзНржпрж╛ржбрж╛ржкрзНржЯрж╛рж░рзЗрж░ ржУржЬржиржЧрзБрж▓рзЛ ржмрзЗрж╕ ржоржбрзЗрж▓рзЗрж░ рж╕рж╛ржерзЗ ржорж┐рж╢рж┐рзЯрзЗ ржжрзЗржУрзЯрж╛ред
1. ржоржбрзЗрж▓ржЯрж┐ `int4`-ржП ржЕржкрзНржЯрж┐ржорж╛ржЗржЬ ржПржмржВ ржХрзЛрзЯрж╛ржирзНржЯрж╛ржЗржЬ ржХрж░рж╛ред

ржЖржорж░рж╛ ржЖржкржирж╛ржХрзЗ ONNX Runtime (ORT) Generate API ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржлрж╛ржЗржи-ржЯрж┐ржЙржи ржХрж░рж╛ ржоржбрзЗрж▓рзЗ ржЗржиржлрж╛рж░рзЗржирзНрж╕ ржХрж░рж╛рж░ ржкржжрзНржзрждрж┐ржУ ржжрзЗржЦрж╛ржмред

> **тЪая╕П ржлрж╛ржЗржи-ржЯрж┐ржЙржирж┐ржВ ржПрж░ ржЬржирзНржп, ржЖржкржирж╛рж░ ржПржХржЯрж┐ ржЙржкржпрзБржХрзНржд GPU ржерж╛ржХрждрзЗ рж╣ржмрзЗ - ржпрзЗржоржи, A10, V100, A100ред**

## ЁЯТ╛ ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи

ржПржХржЯрж┐ ржирждрзБржи Python ржнрж╛рж░рзНржЪрзБржпрж╝рж╛рж▓ ржПржиржнрж╛ржпрж╝рж░ржиржорзЗржирзНржЯ рждрзИрж░рж┐ ржХрж░рзБржи (ржЙржжрж╛рж╣рж░ржгрж╕рзНржмрж░рзВржк, `conda` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ):

```bash
conda create -n olive-ai python=3.11
conda activate olive-ai
```

ржПрж░ржкрж░, Olive ржПржмржВ ржлрж╛ржЗржи-ржЯрж┐ржЙржирж┐ржВ ржУржпрж╝рж╛рж░рзНржХржлрзНрж▓рзЛрж░ ржЬржирзНржп ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ ржбрж┐ржкрзЗржирзНржбрзЗржирзНрж╕рж┐ржЧрзБрж▓рзЛ ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи:

```bash
cd Phi-3CookBook/code/04.Finetuning/olive-ort-example
pip install olive-ai[gpu]
pip install -r requirements.txt
```

## ЁЯзк Olive ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ Phi3 ржлрж╛ржЗржи-ржЯрж┐ржЙржи ржХрж░рзБржи
[Olive ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржлрж╛ржЗрж▓](../../../../../code/03.Finetuning/olive-ort-example/phrase-classification.json)-ржП ржПржХржЯрж┐ *ржУржпрж╝рж╛рж░рзНржХржлрзНрж▓рзЛ* рж░ржпрж╝рзЗржЫрзЗ, ржпрзЗржЦрж╛ржирзЗ ржирж┐ржорзНржирж▓рж┐ржЦрж┐ржд *ржкрж╛рж╕* ржЕржирзНрждрж░рзНржнрзБржХрзНржд:

Phi3 -> LoRA -> MergeAdapterWeights -> ModelBuilder

ржЙржЪрзНржЪ-рж╕рзНрждрж░рзЗ, ржПржЗ ржУржпрж╝рж╛рж░рзНржХржлрзНрж▓рзЛржЯрж┐ ржХрж░ржмрзЗ:

1. Phi3-ржХрзЗ ржлрж╛ржЗржи-ржЯрж┐ржЙржи ржХрж░рж╛ (рззрзлрзж ржзрж╛ржкрзЗрж░ ржЬржирзНржп, ржпрж╛ ржЖржкржирж┐ ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рждрзЗ ржкрж╛рж░рзЗржи) [dataset/data-classification.json](../../../../../code/03.Finetuning/olive-ort-example/dataset/dataset-classification.json) ржбрзЗржЯрж╛ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗред
1. LoRA ржЕрзНржпрж╛ржбрж╛ржкрзНржЯрж╛рж░рзЗрж░ ржУржЬржиржЧрзБрж▓рзЛ ржмрзЗрж╕ ржоржбрзЗрж▓рзЗрж░ рж╕рж╛ржерзЗ ржорж┐рж╢рж┐рзЯрзЗ ржжрзЗржУрзЯрж╛ред ржПрж░ ржлрж▓рзЗ ржЖржкржирж╛рж░ ржХрж╛ржЫрзЗ ржПржХржЯрж┐ ржПржХржХ ONNX ржлрж░ржорзНржпрж╛ржЯрзЗрж░ ржоржбрзЗрж▓ ржЖрж░рзНржЯрж┐ржлрзНржпрж╛ржХрзНржЯ ржерж╛ржХржмрзЗред
1. Model Builder ржоржбрзЗрж▓ржЯрж┐ржХрзЗ ONNX runtime ржПрж░ ржЬржирзНржп ржЕржкрзНржЯрж┐ржорж╛ржЗржЬ ржХрж░ржмрзЗ *ржПржмржВ* ржоржбрзЗрж▓ржЯрж┐ржХрзЗ `int4`-ржП ржХрзЛрзЯрж╛ржирзНржЯрж╛ржЗржЬ ржХрж░ржмрзЗред

ржУржпрж╝рж╛рж░рзНржХржлрзНрж▓рзЛржЯрж┐ ржЪрж╛рж▓рж╛ржирзЛрж░ ржЬржирзНржп, рж░рж╛ржи ржХрж░рзБржи:

```bash
olive run --config phrase-classification.json
```

Olive ржХрж╛ржЬ рж╕ржорзНржкржирзНржи ржХрж░рж▓рзЗ, ржЖржкржирж╛рж░ ржЕржкрзНржЯрж┐ржорж╛ржЗржЬ ржХрж░рж╛ `int4` ржлрж╛ржЗржи-ржЯрж┐ржЙржи ржХрж░рж╛ Phi3 ржоржбрзЗрж▓ржЯрж┐ ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржмрзЗ ржПржЦрж╛ржирзЗ: `code/04.Finetuning/olive-ort-example/models/lora-merge-mb/gpu-cuda_model`ред

## ЁЯзСтАНЁЯТ╗ ржЖржкржирж╛рж░ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржирзЗ ржлрж╛ржЗржи-ржЯрж┐ржЙржи ржХрж░рж╛ Phi3 ржЗржирзНржЯрж┐ржЧрзНрж░рзЗржЯ ржХрж░рзБржи

ржЕрзНржпрж╛ржкржЯрж┐ ржЪрж╛рж▓рж╛ржирзЛрж░ ржЬржирзНржп:

```bash
python app/app.py --phrase "cricket is a wonderful sport!" --model-path models/lora-merge-mb/gpu-cuda_model
```

ржПржЗ рж░рзЗрж╕ржкржирзНрж╕ржЯрж┐ ржмрж╛ржХрзНржпрзЗрж░ ржПржХржЯрж┐ ржПржХржХ рж╢ржмрзНржжрзЗрж░ рж╢рзНрж░рзЗржгрж┐ржмрж┐ржирзНржпрж╛рж╕ рж╣ржмрзЗ (Sad/Joy/Fear/Surprise)ред

**ржЕрж╕рзНржмрзАржХрзГрждрж┐**:  
ржПржЗ ржиржерж┐ ржорзЗрж╢рж┐ржи-ржнрж┐рждрзНрждрж┐ржХ ржПржЖржЗ ржЕржирзБржмрж╛ржж ржкрж░рж┐рж╖рзЗржмрж╛ржЧрзБрж▓рж┐рж░ ржорж╛ржзрзНржпржорзЗ ржЕржирзБржмрж╛ржж ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗред ржЖржорж░рж╛ ржпржерж╛рж╕рж╛ржзрзНржп ржирж┐рж░рзНржнрзБрж▓рждрж╛рж░ ржЬржирзНржп ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рж┐, рждржмрзЗ ржжржпрж╝рж╛ ржХрж░рзЗ ржоржирзЗ рж░рж╛ржЦржмрзЗржи ржпрзЗ рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ ржЕржирзБржмрж╛ржжрзЗ ржнрзБрж▓ ржмрж╛ ржЕрж╕ржВржЧрждрж┐ ржерж╛ржХрждрзЗ ржкрж╛рж░рзЗред ржПрж░ ржорзВрж▓ ржнрж╛рж╖рж╛ржпрж╝ ржерж╛ржХрж╛ ржЖрж╕рж▓ ржиржерж┐ржЯрж┐ржХрзЗ ржирж┐рж░рзНржнрж░ржпрзЛржЧрзНржп ржЙрзОрж╕ рж╣рж┐рж╕рзЗржмрзЗ ржмрж┐ржмрзЗржЪржирж╛ ржХрж░рж╛ ржЙржЪрж┐рждред ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг рждржерзНржпрзЗрж░ ржЬржирзНржп ржкрзЗрж╢рж╛ржжрж╛рж░ ржорж╛ржиржм ржЕржирзБржмрж╛ржж рж╕рзБржкрж╛рж░рж┐рж╢ ржХрж░рж╛ рж╣ржпрж╝ред ржПржЗ ржЕржирзБржмрж╛ржж ржмрзНржпржмрж╣рж╛рж░рзЗрж░ ржлрж▓рзЗ рж╕рзГрж╖рзНржЯ ржпрзЗржХрзЛржирзЛ ржнрзБрж▓ ржмрзЛржЭрж╛ржмрзБржЭрж┐ ржмрж╛ ржнрзБрж▓ ржмрзНржпрж╛ржЦрзНржпрж╛рж░ ржЬржирзНржп ржЖржорж░рж╛ ржжрж╛ржпрж╝рзА ржерж╛ржХржм ржирж╛ред