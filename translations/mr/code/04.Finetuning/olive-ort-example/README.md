# Olive рд╡рд╛рдкрд░реВрди Phi3 рдлрд╛рдЗрди-рдЯреНрдпреВрди рдХрд░рд╛

рдпрд╛ рдЙрджрд╛рд╣рд░рдгрд╛рдд рддреБрдореНрд╣реА Olive рдЪрд╛ рд╡рд╛рдкрд░ рдХрд░реВрди рдЦрд╛рд▓реАрд▓ рдЧреЛрд╖реНрдЯреА рд╢рд┐рдХрд╛рд▓:

1. Sad, Joy, Fear, Surprise рдпрд╛ рд╡рд░реНрдЧрд╛рдВрдордзреНрдпреЗ рд╡рд╛рдХреНрдпреЗ рд╡рд░реНрдЧреАрдХреГрдд рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА LoRA рдЕрдбреЕрдкреНрдЯрд░ рдлрд╛рдЗрди-рдЯреНрдпреВрди рдХрд░рд╛.
1. рдЕрдбреЕрдкреНрдЯрд░рдЪреЗ рд╡рдЬрди рдмреЗрд╕ рдореЙрдбреЗрд▓рдордзреНрдпреЗ рд╡рд┐рд▓реАрди рдХрд░рд╛.
1. рдореЙрдбреЗрд▓ `int4` рдордзреНрдпреЗ рдСрдкреНрдЯрд┐рдорд╛рдЗрдЭ рдЖрдгрд┐ рдХреНрд╡рд╛рдВрдЯрд╛рдЗрдЭ рдХрд░рд╛.

рддрд╕реЗрдЪ, ONNX Runtime (ORT) Generate API рд╡рд╛рдкрд░реВрди рдлрд╛рдЗрди-рдЯреНрдпреВрди рдХреЗрд▓реЗрд▓реНрдпрд╛ рдореЙрдбреЗрд▓рдЪреЗ рдЗрдиреНрдлрд░рдиреНрд╕ рдХрд╕реЗ рдХрд░рд╛рдпрдЪреЗ рддреЗ рджрд╛рдЦрд╡рд▓реЗ рдЬрд╛рдИрд▓.

> **тЪая╕П рдлрд╛рдЗрди-рдЯреНрдпреВрдирд┐рдВрдЧрд╕рд╛рдареА, рддреБрдордЪреНрдпрд╛рдХрдбреЗ рдпреЛрдЧреНрдп GPU рдЕрд╕рдгреЗ рдЖрд╡рд╢реНрдпрдХ рдЖрд╣реЗ - рдЙрджрд╛рд╣рд░рдгрд╛рд░реНрде, A10, V100, A100.**

## ЁЯТ╛ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рд╛

Python рд╕рд╛рдареА рдПрдХ рдирд╡реАрди рд╡рд░реНрдЪреБрдЕрд▓ рдПрдиреНрд╡реНрд╣рд╛рдпрд░реНрдирдореЗрдВрдЯ рддрдпрд╛рд░ рдХрд░рд╛ (рдЙрджрд╛рд╣рд░рдгрд╛рд░реНрде, `conda` рд╡рд╛рдкрд░реВрди):

```bash
conda create -n olive-ai python=3.11
conda activate olive-ai
```

рдпрд╛рдирдВрддрд░, Olive рдЖрдгрд┐ рдлрд╛рдЗрди-рдЯреНрдпреВрдирд┐рдВрдЧ рд╡рд░реНрдХрдлреНрд▓реЛрдЪреНрдпрд╛ рдбрд┐рдкреЗрдВрдбрдиреНрд╕реА рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рд╛:

```bash
cd Phi-3CookBook/code/04.Finetuning/olive-ort-example
pip install olive-ai[gpu]
pip install -r requirements.txt
```

## ЁЯзк Olive рд╡рд╛рдкрд░реВрди Phi3 рдлрд╛рдЗрди-рдЯреНрдпреВрди рдХрд░рд╛
[Olive рдХреЙрдиреНрдлрд┐рдЧрд░реЗрд╢рди рдлрд╛рдЗрд▓](../../../../../code/04.Finetuning/olive-ort-example/phrase-classification.json) рдордзреНрдпреЗ рдЦрд╛рд▓реАрд▓ *рдкрд╛рд╕реЗрд╕* рдЕрд╕рд▓реЗрд▓рд╛ рдПрдХ *рд╡рд░реНрдХрдлреНрд▓реЛ* рдЖрд╣реЗ:

Phi3 -> LoRA -> MergeAdapterWeights -> ModelBuilder

рдЙрдЪреНрдЪ-рд╕реНрддрд░реАрдп рджреГрд╖реНрдЯреАрдХреЛрдирд╛рддреВрди, рд╣рд╛ рд╡рд░реНрдХрдлреНрд▓реЛ рдЦрд╛рд▓реАрд▓рдкреНрд░рдорд╛рдгреЗ рдЕрд╕реЗрд▓:

1. [dataset/data-classification.json](../../../../../code/04.Finetuning/olive-ort-example/dataset/dataset-classification.json) рдбреЗрдЯрд╛ рд╡рд╛рдкрд░реВрди Phi3 рд▓рд╛ рдлрд╛рдЗрди-рдЯреНрдпреВрди рдХрд░рд╛ (150 рд╕реНрдЯреЗрдкреНрд╕рд╕рд╛рдареА, рдЬреЗ рддреБрдореНрд╣реА рдмрджрд▓реВ рд╢рдХрддрд╛).
1. LoRA рдЕрдбреЕрдкреНрдЯрд░рдЪреЗ рд╡рдЬрди рдмреЗрд╕ рдореЙрдбреЗрд▓рдордзреНрдпреЗ рд╡рд┐рд▓реАрди рдХрд░рд╛. рдпрд╛рдореБрд│реЗ ONNX рдлреЙрд░рдореЕрдЯрдордзреНрдпреЗ рдПрдХрдЪ рдореЙрдбреЗрд▓ рдЖрд░реНрдЯрд┐рдлреЕрдХреНрдЯ рдорд┐рд│реЗрд▓.
1. Model Builder рдореЙрдбреЗрд▓ ONNX runtime рд╕рд╛рдареА рдСрдкреНрдЯрд┐рдорд╛рдЗрдЭ рдХрд░реЗрд▓ *рдЖрдгрд┐* рдореЙрдбреЗрд▓ `int4` рдордзреНрдпреЗ рдХреНрд╡рд╛рдВрдЯрд╛рдЗрдЭ рдХрд░реЗрд▓.

рд╡рд░реНрдХрдлреНрд▓реЛ рдЪрд╛рд▓рд╡рдгреНрдпрд╛рд╕рд╛рдареА, рд╣реЗ рдЪрд╛рд▓рд╡рд╛:

```bash
olive run --config phrase-classification.json
```

Olive рдкреВрд░реНрдг рдЭрд╛рд▓реНрдпрд╛рд╡рд░, рддреБрдордЪреЗ рдСрдкреНрдЯрд┐рдорд╛рдЗрдЭ рдХреЗрд▓реЗрд▓реЗ `int4` рдлрд╛рдЗрди-рдЯреНрдпреВрди Phi3 рдореЙрдбреЗрд▓ рдпреЗрдереЗ рдЙрдкрд▓рдмреНрдз рдЕрд╕реЗрд▓: `code/04.Finetuning/olive-ort-example/models/lora-merge-mb/gpu-cuda_model`.

## ЁЯзСтАНЁЯТ╗ рдлрд╛рдЗрди-рдЯреНрдпреВрди рдХреЗрд▓реЗрд▓реЗ Phi3 рддреБрдордЪреНрдпрд╛ ре▓рдкреНрд▓рд┐рдХреЗрд╢рдирдордзреНрдпреЗ рд╕рдорд╛рд╡рд┐рд╖реНрдЯ рдХрд░рд╛ 

ре▓рдк рдЪрд╛рд▓рд╡рдгреНрдпрд╛рд╕рд╛рдареА:

```bash
python app/app.py --phrase "cricket is a wonderful sport!" --model-path models/lora-merge-mb/gpu-cuda_model
```

рд╣реЗ рдЙрддреНрддрд░ рд╡рд╛рдХреНрдпрд╛рдЪреЗ рдПрдХрд▓ рд╢рдмреНрдж рд╡рд░реНрдЧреАрдХрд░рдг (Sad/Joy/Fear/Surprise) рдЕрд╕реЗрд▓.

**рдЕрд╕реНрд╡реАрдХрд░рдг**:  
рд╣реЗ рджрд╕реНрддрдРрд╡рдЬ рдорд╢реАрди-рдЖрдзрд╛рд░рд┐рдд рдПрдЖрдп рдЕрдиреБрд╡рд╛рдж рд╕реЗрд╡рд╛рдВрдЪрд╛ рд╡рд╛рдкрд░ рдХрд░реВрди рдЕрдиреБрд╡рд╛рджрд┐рдд рдХреЗрд▓реЗ рдЧреЗрд▓реЗ рдЖрд╣реЗ. рдЖрдореНрд╣реА рдЕрдЪреВрдХрддреЗрд╕рд╛рдареА рдкреНрд░рдпрддреНрдирд╢реАрд▓ рдЕрд╕рд▓реЛ рддрд░реА, рдХреГрдкрдпрд╛ рд▓рдХреНрд╖рд╛рдд рдШреНрдпрд╛ рдХреА рд╕реНрд╡рдпрдВрдЪрд▓рд┐рдд рдЕрдиреБрд╡рд╛рджрд╛рдВрдордзреНрдпреЗ рддреНрд░реБрдЯреА рдХрд┐рдВрд╡рд╛ рдЕрдЪреВрдХрддреЗрдЪрд╛ рдЕрднрд╛рд╡ рдЕрд╕реВ рд╢рдХрддреЛ. рдореВрд│ рднрд╛рд╖реЗрддреАрд▓ рдореВрд│ рджрд╕реНрддрдРрд╡рдЬ рдЕрдзрд┐рдХреГрдд рд╕реНрд░реЛрдд рдорд╛рдирд▓рд╛ рдЬрд╛рд╡рд╛. рдорд╣рддреНрддреНрд╡рд╛рдЪреНрдпрд╛ рдорд╛рд╣рд┐рддреАрд╕рд╛рдареА, рд╡реНрдпрд╛рд╡рд╕рд╛рдпрд┐рдХ рдорд╛рдирд╡реА рдЕрдиреБрд╡рд╛рджрд╛рдЪреА рд╢рд┐рдлрд╛рд░рд╕ рдХреЗрд▓реА рдЬрд╛рддреЗ. рдпрд╛ рдЕрдиреБрд╡рд╛рджрд╛рдЪрд╛ рд╡рд╛рдкрд░ рдХреЗрд▓реНрдпрд╛рдореБрд│реЗ рдЙрджреНрднрд╡рдгрд╛рд▒реНрдпрд╛ рдХреЛрдгрддреНрдпрд╛рд╣реА рдЧреИрд░рд╕рдордЬ рдХрд┐рдВрд╡рд╛ рдЪреБрдХреАрдЪреНрдпрд╛ рдЕрд░реНрдерд╛рд╕рд╛рдареА рдЖрдореНрд╣реА рдЬрдмрд╛рдмрджрд╛рд░ рд░рд╛рд╣рдгрд╛рд░ рдирд╛рд╣реА.