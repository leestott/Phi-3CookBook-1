# Olive рд╡рд╛рдкрд░реВрди Phi3 рдлрд╛рдЗрди-рдЯреНрдпреВрди рдХрд░рд╛

рдпрд╛ рдЙрджрд╛рд╣рд░рдгрд╛рдд рддреБрдореНрд╣реА Olive рд╡рд╛рдкрд░реВрди рдЦрд╛рд▓реАрд▓ рдЧреЛрд╖реНрдЯреА рд╢рд┐рдХрд╛рд▓:

1. LoRA рдЕтАНреЕрдбреЙрдкреНрдЯрд░ рдлрд╛рдЗрди-рдЯреНрдпреВрди рдХрд░рд╛ рдЬреНрдпрд╛рдореБрд│реЗ рд╡рд╛рдХреНрдп Sad, Joy, Fear, Surprise рдпрд╛ рд╢реНрд░реЗрдгреАрдВрдордзреНрдпреЗ рд╡рд░реНрдЧреАрдХреГрдд рд╣реЛрддреАрд▓.
1. рдЕтАНреЕрдбреЙрдкреНрдЯрд░рдЪреЗ рд╡реЗрдЯреНрд╕ рдмреЗрд╕ рдореЙрдбреЗрд▓рдордзреНрдпреЗ рдорд░реНрдЬ рдХрд░рд╛.
1. рдореЙрдбреЗрд▓ `int4` рдордзреНрдпреЗ рдСрдкреНрдЯрд┐рдорд╛рдЗрдЭ рдЖрдгрд┐ рдХреНрд╡рд╛рдВрдЯрд╛рдЗрдЭ рдХрд░рд╛.

рдЖрдореНрд╣реА рддреБрдореНрд╣рд╛рд▓рд╛ ONNX Runtime (ORT) Generate API рд╡рд╛рдкрд░реВрди рдлрд╛рдЗрди-рдЯреНрдпреВрди рдХреЗрд▓реЗрд▓реНрдпрд╛ рдореЙрдбреЗрд▓рд╕рд╛рдареА рдЗрдирдлрд░рдиреНрд╕ рдХрд╕рд╛ рдХрд░рд╛рдпрдЪрд╛ рддреЗрд╣реА рджрд╛рдЦрд╡реВ.

> **тЪая╕П рдлрд╛рдЗрди-рдЯреНрдпреВрдирд┐рдВрдЧрд╕рд╛рдареА, рддреБрдордЪреНрдпрд╛рдХрдбреЗ рдпреЛрдЧреНрдп GPU рдЙрдкрд▓рдмреНрдз рдЕрд╕рдгреЗ рдЖрд╡рд╢реНрдпрдХ рдЖрд╣реЗ - рдЙрджрд╛рд╣рд░рдгрд╛рд░реНрде, A10, V100, A100.**

## ЁЯТ╛ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рд╛

рдирд╡реАрди Python рд╡рд░реНрдЪреНрдпреБрдЕрд▓ рдПрдиреНрд╡реНрд╣рд╛рдпрд░реНрдирдореЗрдВрдЯ рддрдпрд╛рд░ рдХрд░рд╛ (рдЙрджрд╛рд╣рд░рдгрд╛рд░реНрде, `conda` рд╡рд╛рдкрд░реВрди):

```bash
conda create -n olive-ai python=3.11
conda activate olive-ai
```

рдпрд╛рдирдВрддрд░, Olive рдЖрдгрд┐ рдлрд╛рдЗрди-рдЯреНрдпреВрдирд┐рдВрдЧ рд╡рд░реНрдХрдлреНрд▓реЛрдЪреНрдпрд╛ рдбрд┐рдкреЗрдВрдбрдиреНрд╕реА рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рд╛:

```bash
cd Phi-3CookBook/code/04.Finetuning/olive-ort-example
pip install olive-ai[gpu]
pip install -r requirements.txt
```

## ЁЯзк Olive рд╡рд╛рдкрд░реВрди Phi3 рдлрд╛рдЗрди-рдЯреНрдпреВрди рдХрд░рд╛
[Olive рдХреЙрдиреНрдлрд┐рдЧрд░реЗрд╢рди рдлрд╛рдИрд▓](../../../../../code/03.Finetuning/olive-ort-example/phrase-classification.json) рдордзреНрдпреЗ рдЦрд╛рд▓реАрд▓ *рдкрд╛рд╕реЗрд╕* рдЕрд╕рд▓реЗрд▓рд╛ *рд╡рд░реНрдХрдлреНрд▓реЛ* рдЖрд╣реЗ:

Phi3 -> LoRA -> MergeAdapterWeights -> ModelBuilder

рдпрд╛ рд╡рд░реНрдХрдлреНрд▓реЛрдЪрд╛ рдЙрдЪреНрдЪ-рд╕реНрддрд░реАрдп рдЖрдврд╛рд╡рд╛ рдЕрд╕рд╛ рдЖрд╣реЗ:

1. Phi3 рд▓рд╛ рдлрд╛рдЗрди-рдЯреНрдпреВрди рдХрд░рд╛ (150 рд╕реНрдЯреЗрдкреНрд╕рд╕рд╛рдареА, рдЬреНрдпрд╛рдд рддреБрдореНрд╣реА рдмрджрд▓ рдХрд░реВ рд╢рдХрддрд╛) [dataset/data-classification.json](../../../../../code/03.Finetuning/olive-ort-example/dataset/dataset-classification.json) рдбреЗрдЯрд╛рдЪрд╛ рд╡рд╛рдкрд░ рдХрд░реВрди.
1. LoRA рдЕтАНреЕрдбреЙрдкреНрдЯрд░ рд╡реЗрдЯреНрд╕ рдмреЗрд╕ рдореЙрдбреЗрд▓рдордзреНрдпреЗ рдорд░реНрдЬ рдХрд░рд╛. рдпрд╛рдореБрд│реЗ рддреБрдореНрд╣рд╛рд▓рд╛ ONNX рдлреЙрд░рдореЕрдЯрдордзреНрдпреЗ рд╕рд┐рдВрдЧрд▓ рдореЙрдбреЗрд▓ рдЖрд░реНрдЯрд┐рдлреЕрдХреНрдЯ рдорд┐рд│реЗрд▓.
1. Model Builder рдореЙрдбреЗрд▓ ONNX runtime рд╕рд╛рдареА рдСрдкреНрдЯрд┐рдорд╛рдЗрдЭ рдХрд░реЗрд▓ *рдЖрдгрд┐* рдореЙрдбреЗрд▓рд▓рд╛ `int4` рдордзреНрдпреЗ рдХреНрд╡рд╛рдВрдЯрд╛рдЗрдЭ рдХрд░реЗрд▓.

рд╡рд░реНрдХрдлреНрд▓реЛ рд░рди рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА, рдЦрд╛рд▓реАрд▓ рдЖрджреЗрд╢ рд╡рд╛рдкрд░рд╛:

```bash
olive run --config phrase-classification.json
```

Olive рдкреВрд░реНрдг рдЭрд╛рд▓реНрдпрд╛рдирдВрддрд░, рдСрдкреНрдЯрд┐рдорд╛рдЗрдЭ рдХреЗрд▓реЗрд▓реЗ `int4` рдлрд╛рдЗрди-рдЯреНрдпреВрди Phi3 рдореЙрдбреЗрд▓ рдпреЗрдереЗ рдЙрдкрд▓рдмреНрдз рдЕрд╕реЗрд▓: `code/04.Finetuning/olive-ort-example/models/lora-merge-mb/gpu-cuda_model`.

## ЁЯзСтАНЁЯТ╗ рдлрд╛рдЗрди-рдЯреНрдпреВрди рдХреЗрд▓реЗрд▓реЗ Phi3 рддреБрдордЪреНрдпрд╛ ре▓рдкреНрд▓рд┐рдХреЗрд╢рдирдордзреНрдпреЗ рд╕рдорд╛рдХрд▓рд┐рдд рдХрд░рд╛

ре▓рдк рдЪрд╛рд▓рд╡рдгреНрдпрд╛рд╕рд╛рдареА:

```bash
python app/app.py --phrase "cricket is a wonderful sport!" --model-path models/lora-merge-mb/gpu-cuda_model
```

рдпрд╛ рдкреНрд░рддрд┐рд╕рд╛рджрд╛рдд рд╡рд╛рдХреНрдпрд╛рдЪрд╛ рд╡рд░реНрдЧ (Sad/Joy/Fear/Surprise) рдПрдХрд╛ рд╢рдмреНрджрд╛рдд рджрд┐рд▓рд╛ рдЬрд╛рдИрд▓.

**рдЕрд╕реНрд╡реАрдХрд░рдг**:  
рд╣реЗ рджрд╕реНрддрдРрд╡рдЬ рдорд╢реАрди-рдЖрдзрд╛рд░рд┐рдд AI рдЕрдиреБрд╡рд╛рдж рд╕реЗрд╡рд╛ рд╡рд╛рдкрд░реВрди рдЕрдиреБрд╡рд╛рджрд┐рдд рдХреЗрд▓реЗ рдЧреЗрд▓реЗ рдЖрд╣реЗ. рдЖрдореНрд╣реА рдЕрдЪреВрдХрддреЗрд╕рд╛рдареА рдкреНрд░рдпрддреНрдирд╢реАрд▓ рдЕрд╕рд▓реЛ рддрд░реА, рдХреГрдкрдпрд╛ рд▓рдХреНрд╖рд╛рдд рдШреНрдпрд╛ рдХреА рд╕реНрд╡рдпрдВрдЪрд▓рд┐рдд рдЕрдиреБрд╡рд╛рджрд╛рдВрдордзреНрдпреЗ рддреНрд░реБрдЯреА рдХрд┐рдВрд╡рд╛ рдЕрдЪреВрдХрддреЗрдЪрд╛ рдЕрднрд╛рд╡ рдЕрд╕реВ рд╢рдХрддреЛ. рдореВрд│ рднрд╛рд╖реЗрддреАрд▓ рдореВрд│ рджрд╕реНрддрдРрд╡рдЬ рд╣рд╛ рдЕрдзрд┐рдХреГрдд рд╕реНрд░реЛрдд рдорд╛рдирд▓рд╛ рдЬрд╛рд╡рд╛. рдорд╣рддреНрддреНрд╡рд╛рдЪреНрдпрд╛ рдорд╛рд╣рд┐рддреАрд╕рд╛рдареА, рд╡реНрдпрд╛рд╡рд╕рд╛рдпрд┐рдХ рдорд╛рдирд╡реА рдЕрдиреБрд╡рд╛рджрд╛рдЪреА рд╢рд┐рдлрд╛рд░рд╕ рдХреЗрд▓реА рдЬрд╛рддреЗ. рдпрд╛ рдЕрдиреБрд╡рд╛рджрд╛рдЪреНрдпрд╛ рд╡рд╛рдкрд░рд╛рдореБрд│реЗ рдЙрджреНрднрд╡рдгрд╛рд▒реНрдпрд╛ рдХреЛрдгрддреНрдпрд╛рд╣реА рдЧреИрд░рд╕рдордЬреБрддреАрдВрд╕рд╛рдареА рдХрд┐рдВрд╡рд╛ рдЪреБрдХреАрдЪреНрдпрд╛ рдЕрд░реНрдерд╛рд╕рд╛рдареА рдЖрдореНрд╣реА рдЬрдмрд╛рдмрджрд╛рд░ рд░рд╛рд╣рдгрд╛рд░ рдирд╛рд╣реА.