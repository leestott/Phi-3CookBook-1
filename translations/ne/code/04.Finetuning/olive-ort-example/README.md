# Olive рдкреНрд░рдпреЛрдЧ рдЧрд░реЗрд░ Phi3 рд▓рд╛рдИ Fine-tune рдЧрд░реНрдиреБрд╣реЛрд╕реН

рдпрд╕ рдЙрджрд╛рд╣рд░рдгрдорд╛ рддрдкрд╛рдИрдВ Olive рдкреНрд░рдпреЛрдЧ рдЧрд░реЗрд░ рдирд┐рдореНрди рдХрд╛рд░реНрдпрд╣рд░реВ рдЧрд░реНрдиреБрд╣реБрдиреЗрдЫ:

1. LoRA adapter рд▓рд╛рдИ Fine-tune рдЧрд░реЗрд░ рд╡рд╛рдХреНрдпрд╛рдВрд╢рд╣рд░реВрд▓рд╛рдИ Sad, Joy, Fear, Surprise рдорд╛ рд╡рд░реНрдЧреАрдХреГрдд рдЧрд░реНрдиреБрд╣реЛрд╕реНред
1. Adapter рдХрд╛ рд╡рдЬрдирд╣рд░реВрд▓рд╛рдИ рдЖрдзрд╛рд░рднреВрдд рдореЛрдбреЗрд▓рдорд╛ рдорд░реНрдЬ рдЧрд░реНрдиреБрд╣реЛрд╕реНред
1. рдореЛрдбреЗрд▓рд▓рд╛рдИ `int4` рдорд╛ Optimize рд░ Quantize рдЧрд░реНрдиреБрд╣реЛрд╕реНред

рд╣рд╛рдореА рддрдкрд╛рдИрдВрд▓рд╛рдИ ONNX Runtime (ORT) Generate API рдкреНрд░рдпреЛрдЧ рдЧрд░реЗрд░ Fine-tuned рдореЛрдбреЗрд▓рд▓рд╛рдИ рдХрд╕рд░реА inference рдЧрд░реНрдиреЗ рднрдиреЗрд░ рдкрдирд┐ рджреЗрдЦрд╛рдЙрдиреЗрдЫреМрдВред

> **тЪая╕П Fine-tuning рдХреЛ рд▓рд╛рдЧрд┐, рддрдкрд╛рдИрдВрд▓рд╛рдИ рдЙрдкрдпреБрдХреНрдд GPU рдЙрдкрд▓рдмреНрдз рд╣реБрди рдЖрд╡рд╢реНрдпрдХ рдЫ - рдЙрджрд╛рд╣рд░рдгрдХрд╛ рд▓рд╛рдЧрд┐, A10, V100, A100ред**

## ЁЯТ╛ рд╕реНрдерд╛рдкрдирд╛ рдЧрд░реНрдиреБрд╣реЛрд╕реН

рдирдпрд╛рдБ Python рднрд░реНрдЪреБрдЕрд▓ рд╡рд╛рддрд╛рд╡рд░рдг рд╕рд┐рд░реНрдЬрдирд╛ рдЧрд░реНрдиреБрд╣реЛрд╕реН (рдЙрджрд╛рд╣рд░рдгрдХрд╛ рд▓рд╛рдЧрд┐, `conda` рдкреНрд░рдпреЛрдЧ рдЧрд░реЗрд░):

```bash
conda create -n olive-ai python=3.11
conda activate olive-ai
```

рдкрдЫрд╛рдбрд┐, Olive рд░ Fine-tuning workflow рдХрд╛ рд▓рд╛рдЧрд┐ рдЖрд╡рд╢реНрдпрдХ dependencies рд╕реНрдерд╛рдкрдирд╛ рдЧрд░реНрдиреБрд╣реЛрд╕реН:

```bash
cd Phi-3CookBook/code/04.Finetuning/olive-ort-example
pip install olive-ai[gpu]
pip install -r requirements.txt
```

## ЁЯзк Olive рдкреНрд░рдпреЛрдЧ рдЧрд░реЗрд░ Phi3 рд▓рд╛рдИ Fine-tune рдЧрд░реНрдиреБрд╣реЛрд╕реН
[Olive configuration file](../../../../../code/04.Finetuning/olive-ort-example/phrase-classification.json) рдорд╛ *workflow* рдирд┐рдореНрди *passes* рд╕рдорд╛рд╡реЗрд╢ рдЧрд░реНрджрдЫ:

Phi3 -> LoRA -> MergeAdapterWeights -> ModelBuilder

рдЙрдЪреНрдЪ-рд╕реНрддрд░рдорд╛, рдпреЛ workflow рд▓реЗ рдирд┐рдореНрди рдХрд╛рд░реНрдпрд╣рд░реВ рдЧрд░реНрджрдЫ:

1. [dataset/data-classification.json](../../../../../code/04.Finetuning/olive-ort-example/dataset/dataset-classification.json) рдбреЗрдЯрд╛ рдкреНрд░рдпреЛрдЧ рдЧрд░реЗрд░ Phi3 рд▓рд╛рдИ (150 steps рдХреЛ рд▓рд╛рдЧрд┐, рдЬреБрди рддрдкрд╛рдИрдВ рдкрд░рд┐рдорд╛рд░реНрдЬрди рдЧрд░реНрди рд╕рдХреНрдиреБрд╣реБрдиреНрдЫ) Fine-tune рдЧрд░реНрдиреБрд╣реЛрд╕реНред
1. LoRA adapter рдХрд╛ рд╡рдЬрдирд╣рд░реВрд▓рд╛рдИ рдЖрдзрд╛рд░рднреВрдд рдореЛрдбреЗрд▓рдорд╛ рдорд░реНрдЬ рдЧрд░реНрдиреБрд╣реЛрд╕реНред рдпрд╕рд▓реЗ рддрдкрд╛рдИрдВрд▓рд╛рдИ ONNX рдврд╛рдБрдЪрд╛рдорд╛ рдПрдХрд▓ рдореЛрдбреЗрд▓ рдЖрд░реНрдЯрд┐рдлреНрдпрд╛рдХреНрдЯ рджрд┐рдиреЗрдЫред
1. Model Builder рд▓реЗ рдореЛрдбреЗрд▓рд▓рд╛рдИ ONNX runtime рдХрд╛ рд▓рд╛рдЧрд┐ Optimize рдЧрд░реНрдиреЗрдЫ *рд░* рдореЛрдбреЗрд▓рд▓рд╛рдИ `int4` рдорд╛ Quantize рдЧрд░реНрдиреЗрдЫред

workflow рдЪрд▓рд╛рдЙрди, рдирд┐рдореНрди рдХрдорд╛рдгреНрдб рдЪрд▓рд╛рдЙрдиреБрд╣реЛрд╕реН:

```bash
olive run --config phrase-classification.json
```

Olive рд▓реЗ рдХрд╛рдо рдкреВрд░рд╛ рдЧрд░реЗрдкрдЫрд┐, рддрдкрд╛рдИрдВрдХреЛ Optimized `int4` Fine-tuned Phi3 рдореЛрдбреЗрд▓ рдпрд╣рд╛рдБ рдЙрдкрд▓рдмреНрдз рд╣реБрдиреЗрдЫ: `code/04.Finetuning/olive-ort-example/models/lora-merge-mb/gpu-cuda_model`ред

## ЁЯзСтАНЁЯТ╗ Fine-tuned Phi3 рд▓рд╛рдИ рддрдкрд╛рдИрдВрдХреЛ рдПрдкреНрд▓рд┐рдХреЗрд╕рдирдорд╛ рд╕рдорд╛рд╡реЗрд╢ рдЧрд░реНрдиреБрд╣реЛрд╕реН 

рдПрдкреНрд▓рд┐рдХреЗрд╕рди рдЪрд▓рд╛рдЙрди:

```bash
python app/app.py --phrase "cricket is a wonderful sport!" --model-path models/lora-merge-mb/gpu-cuda_model
```

рдпреЛ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╡рд╛рдХреНрдпрд╛рдВрд╢рдХреЛ рдПрдХ рд╢рдмреНрджрдХреЛ рд╡рд░реНрдЧреАрдХрд░рдг (Sad/Joy/Fear/Surprise) рд╣реБрдиреЗрдЫред

**рдЕрд╕реНрд╡реАрдХрд░рдг**:  
рдпреЛ рджрд╕реНрддрд╛рд╡реЗрдЬ рдореЗрд╕рд┐рди-рдЖрдзрд╛рд░рд┐рдд рдПрдЖрдИ рдЕрдиреБрд╡рд╛рдж рд╕реЗрд╡рд╛рд╣рд░реВ рдкреНрд░рдпреЛрдЧ рдЧрд░реА рдЕрдиреБрд╡рд╛рдж рдЧрд░рд┐рдПрдХреЛ рд╣реЛред рд╣рд╛рдореА рд╢реБрджреНрдзрддрд╛рдХреЛ рд▓рд╛рдЧрд┐ рдкреНрд░рдпрд╛рд╕ рдЧрд░реНрджрдЫреМрдВ, рддрд░ рдХреГрдкрдпрд╛ рдЬрд╛рдирдХрд╛рд░ рд╣реБрдиреБрд╣реЛрд╕реН рдХрд┐ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЕрдиреБрд╡рд╛рджрд╣рд░реВрд▓реЗ рддреНрд░реБрдЯрд┐рд╣рд░реВ рд╡рд╛ рдЕрд╢реБрджреНрдзрддрд╛рд╣рд░реВ рд╕рдорд╛рд╡реЗрд╢ рдЧрд░реНрди рд╕рдХреНрдЫред рдпрд╕рдХреЛ рдореМрд▓рд┐рдХ рднрд╛рд╖рд╛рдорд╛ рд░рд╣реЗрдХреЛ рдореВрд▓ рджрд╕реНрддрд╛рд╡реЗрдЬрд▓рд╛рдИ рдкреНрд░рд╛рдзрд┐рдХреГрдд рд╕реНрд░реЛрдд рдорд╛рдирд┐рдиреБрдкрд░реНрдЫред рдорд╣рддреНрддреНрд╡рдкреВрд░реНрдг рдЬрд╛рдирдХрд╛рд░реАрдХрд╛ рд▓рд╛рдЧрд┐, рд╡реНрдпрд╛рд╡рд╕рд╛рдпрд┐рдХ рдорд╛рдирд╡ рдЕрдиреБрд╡рд╛рдж рд╕рд┐рдлрд╛рд░рд┐рд╕ рдЧрд░рд┐рдиреНрдЫред рдпрд╕ рдЕрдиреБрд╡рд╛рджрдХреЛ рдкреНрд░рдпреЛрдЧрдмрд╛рдЯ рдЙрддреНрдкрдиреНрди рд╣реБрдиреЗ рдХреБрдиреИ рдкрдирд┐ рдЧрд▓рддрдлрд╣рдореА рд╡рд╛ рдЧрд▓рдд рд╡реНрдпрд╛рдЦреНрдпрд╛рдХреЛ рд▓рд╛рдЧрд┐ рд╣рд╛рдореА рдЙрддреНрддрд░рджрд╛рдпреА рд╣реБрдиреЗ рдЫреИрдиреМрдВред