# Olive рдкреНрд░рдпреЛрдЧ рдЧрд░реЗрд░ Phi3 рд▓рд╛рдИ рдлрд╛рдЗрди-рдЯреНрдпреБрди рдЧрд░реНрдиреБрд╣реЛрд╕реН

рдпрд╕ рдЙрджрд╛рд╣рд░рдгрдорд╛, рддрдкрд╛рдИрдВ Olive рдкреНрд░рдпреЛрдЧ рдЧрд░реЗрд░ рдирд┐рдореНрди рдХрд╛рд░реНрдпрд╣рд░реВ рдЧрд░реНрдиреБрд╣реБрдиреЗрдЫ:

1. LoRA рдПрдбреЗрдкреНрдЯрд░рд▓рд╛рдИ рдлрд╛рдЗрди-рдЯреНрдпреБрди рдЧрд░реЗрд░ рд╡рд╛рдХреНрдпрд╛рдВрд╢рд╣рд░реВрд▓рд╛рдИ Sad, Joy, Fear, Surprise рдорд╛ рд╡рд░реНрдЧреАрдХреГрдд рдЧрд░реНрдиреБрд╣реЛрд╕реНред
1. рдПрдбреЗрдкреНрдЯрд░рдХрд╛ рд╡рдЬрдирд╣рд░реВрд▓рд╛рдИ рдЖрдзрд╛рд░рднреВрдд рдореЛрдбреЗрд▓рдорд╛ рдорд░реНрдЬ рдЧрд░реНрдиреБрд╣реЛрд╕реНред
1. рдореЛрдбреЗрд▓рд▓рд╛рдИ `int4` рдорд╛ рдЕрдкреНрдЯрд┐рдорд╛рдЗрдЬ рд░ рдХреНрд╡рд╛рдиреНрдЯрд╛рдЗрдЬ рдЧрд░реНрдиреБрд╣реЛрд╕реНред

рд╣рд╛рдореА рддрдкрд╛рдИрдВрд▓рд╛рдИ ONNX Runtime (ORT) Generate API рдкреНрд░рдпреЛрдЧ рдЧрд░реЗрд░ рдлрд╛рдЗрди-рдЯреНрдпреБрди рдЧрд░рд┐рдПрдХреЛ рдореЛрдбреЗрд▓рд▓рд╛рдИ рдХрд╕рд░реА рдЗрдиреНрдлрд░реЗрдиреНрд╕ рдЧрд░реНрдиреЗ рднрдиреНрдиреЗ рдкрдирд┐ рджреЗрдЦрд╛рдЙрдиреЗрдЫреМрдВред

> **тЪая╕П рдлрд╛рдЗрди-рдЯреНрдпреБрдирд┐рдЩрдХрд╛ рд▓рд╛рдЧрд┐, рдЙрдкрдпреБрдХреНрдд GPU рдЙрдкрд▓рдмреНрдз рд╣реБрдиреБ рдЖрд╡рд╢реНрдпрдХ рдЫ - рдЬрд╕реНрддреИ A10, V100, A100ред**

## ЁЯТ╛ рд╕реНрдерд╛рдкрдирд╛ рдЧрд░реНрдиреБрд╣реЛрд╕реН

рдирдпрд╛рдБ Python рднрд░реНрдЪреБрдЕрд▓ рд╡рд╛рддрд╛рд╡рд░рдг рдмрдирд╛рдЙрдиреБрд╣реЛрд╕реН (рдЙрджрд╛рд╣рд░рдгрдХрд╛ рд▓рд╛рдЧрд┐, `conda` рдкреНрд░рдпреЛрдЧ рдЧрд░реЗрд░):

```bash
conda create -n olive-ai python=3.11
conda activate olive-ai
```

рдЕрдм, Olive рд░ рдлрд╛рдЗрди-рдЯреНрдпреБрдирд┐рдЩ рд╡рд░реНрдХрдлреНрд▓реЛрдХрд╛ рд▓рд╛рдЧрд┐ рдЖрд╡рд╢реНрдпрдХ рдирд┐рд░реНрднрд░рддрд╛ рд╕реНрдерд╛рдкрдирд╛ рдЧрд░реНрдиреБрд╣реЛрд╕реН:

```bash
cd Phi-3CookBook/code/04.Finetuning/olive-ort-example
pip install olive-ai[gpu]
pip install -r requirements.txt
```

## ЁЯзк Olive рдкреНрд░рдпреЛрдЧ рдЧрд░реЗрд░ Phi3 рд▓рд╛рдИ рдлрд╛рдЗрди-рдЯреНрдпреБрди рдЧрд░реНрдиреБрд╣реЛрд╕реН
[Olive рдХрдиреНрдлрд┐рдЧрд░реЗрд╕рди рдлрд╛рдЗрд▓](../../../../../code/03.Finetuning/olive-ort-example/phrase-classification.json) рдорд╛ рдирд┐рдореНрди *рдкрд╛рд╕рд╣рд░реВ* рд╕рд╣рд┐рддрдХреЛ *рд╡рд░реНрдХрдлреНрд▓реЛ* рд╕рдорд╛рд╡реЗрд╢ рдЫ:

Phi3 -> LoRA -> MergeAdapterWeights -> ModelBuilder

рдЙрдЪреНрдЪ-рд╕реНрддрд░рдорд╛, рдпреЛ рд╡рд░реНрдХрдлреНрд▓реЛрд▓реЗ рдирд┐рдореНрди рдХрд╛рд░реНрдпрд╣рд░реВ рдЧрд░реНрджрдЫ:

1. [dataset/data-classification.json](../../../../../code/03.Finetuning/olive-ort-example/dataset/dataset-classification.json) рдбрд╛рдЯрд╛рдХреЛ рдкреНрд░рдпреЛрдЧ рдЧрд░реЗрд░ Phi3 рд▓рд╛рдИ (150 рдЪрд░рдгрд╣рд░реВрдХрд╛ рд▓рд╛рдЧрд┐, рдЬреБрди рддрдкрд╛рдИрдВ рдкрд░рд┐рд╡рд░реНрддрди рдЧрд░реНрди рд╕рдХреНрдиреБрд╣реБрдиреНрдЫ) рдлрд╛рдЗрди-рдЯреНрдпреБрди рдЧрд░реНрдиреБрд╣реЛрд╕реНред
1. LoRA рдПрдбреЗрдкреНрдЯрд░рдХрд╛ рд╡рдЬрдирд╣рд░реВрд▓рд╛рдИ рдЖрдзрд╛рд░рднреВрдд рдореЛрдбреЗрд▓рдорд╛ рдорд░реНрдЬ рдЧрд░реНрдиреБрд╣реЛрд╕реНред рдпрд╕рд▓реЗ рддрдкрд╛рдИрдВрд▓рд╛рдИ ONNX рдлрд░реНрдореНрдпрд╛рдЯрдорд╛ рдПрдЙрдЯрд╛ рд╕рд┐рдВрдЧрд▓ рдореЛрдбреЗрд▓ рдЖрд░реНрдЯрд┐рдлреНрдпрд╛рдХреНрдЯ рдкреНрд░рджрд╛рди рдЧрд░реНрдиреЗрдЫред
1. Model Builder рд▓реЗ рдореЛрдбреЗрд▓рд▓рд╛рдИ ONNX runtime рдХрд╛ рд▓рд╛рдЧрд┐ рдЕрдкреНрдЯрд┐рдорд╛рдЗрдЬ рдЧрд░реНрдиреЗрдЫ *рд░* рдореЛрдбреЗрд▓рд▓рд╛рдИ `int4` рдорд╛ рдХреНрд╡рд╛рдиреНрдЯрд╛рдЗрдЬ рдЧрд░реНрдиреЗрдЫред

рд╡рд░реНрдХрдлреНрд▓реЛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдЧрд░реНрди, рдирд┐рдореНрди рдХрдорд╛рдгреНрдб рдЪрд▓рд╛рдЙрдиреБрд╣реЛрд╕реН:

```bash
olive run --config phrase-classification.json
```

Olive рд╕рдорд╛рдкреНрдд рднрдПрдкрдЫрд┐, рддрдкрд╛рдИрдВрдХреЛ рдЕрдкреНрдЯрд┐рдорд╛рдЗрдЬ рдЧрд░рд┐рдПрдХреЛ `int4` рдлрд╛рдЗрди-рдЯреНрдпреБрди рдЧрд░рд┐рдПрдХреЛ Phi3 рдореЛрдбреЗрд▓ рдпрд╣рд╛рдБ рдЙрдкрд▓рдмреНрдз рд╣реБрдиреЗрдЫ: `code/04.Finetuning/olive-ort-example/models/lora-merge-mb/gpu-cuda_model`ред

## ЁЯзСтАНЁЯТ╗ рдлрд╛рдЗрди-рдЯреНрдпреБрди рдЧрд░рд┐рдПрдХреЛ Phi3 рд▓рд╛рдИ рддрдкрд╛рдИрдВрдХреЛ рдПрдкреНрд▓рд┐рдХреЗрд╕рдирдорд╛ рд╕рдорд╛рд╡реЗрд╢ рдЧрд░реНрдиреБрд╣реЛрд╕реН 

рдПрдкреНрд▓рд┐рдХреЗрд╕рди рдЪрд▓рд╛рдЙрдирдХрд╛ рд▓рд╛рдЧрд┐:

```bash
python app/app.py --phrase "cricket is a wonderful sport!" --model-path models/lora-merge-mb/gpu-cuda_model
```

рдпрд╕ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рд▓реЗ рд╡рд╛рдХреНрдпрд╛рдВрд╢рдХреЛ рдПрдХрд▓ рд╢рдмреНрдж рд╡рд░реНрдЧреАрдХрд░рдг (Sad/Joy/Fear/Surprise) рджрд┐рдиреБрдкрд░реНрдЫред

**рдЕрд╕реНрд╡реАрдХрд░рдг**:  
рдпреЛ рджрд╕реНрддрд╛рд╡реЗрдЬ рдореЗрд╕рд┐рди-рдЖрдзрд╛рд░рд┐рдд рдПрдЖрдИ рдЕрдиреБрд╡рд╛рдж рд╕реЗрд╡рд╛рд╣рд░реВ рдкреНрд░рдпреЛрдЧ рдЧрд░реА рдЕрдиреБрд╡рд╛рдж рдЧрд░рд┐рдПрдХреЛ рд╣реЛред рдпрджреНрдпрдкрд┐ рд╣рд╛рдореА рд╢реБрджреНрдзрддрд╛рдХрд╛ рд▓рд╛рдЧрд┐ рдкреНрд░рдпрд╛рд╕ рдЧрд░реНрджрдЫреМрдВ, рдХреГрдкрдпрд╛ рдЬрд╛рдирдХрд╛рд░ рд░рд╣рдиреБрд╣реЛрд╕реН рдХрд┐ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЕрдиреБрд╡рд╛рджрд╣рд░реВрд▓реЗ рддреНрд░реБрдЯрд┐рд╣рд░реВ рд╡рд╛ рдЕрд╢реБрджреНрдзрддрд╛рд╣рд░реВ рд╕рдорд╛рд╡реЗрд╢ рдЧрд░реНрди рд╕рдХреНрдЫред рдпрд╕рдХреЛ рдореВрд▓ рднрд╛рд╖рд╛рдорд╛ рд░рд╣реЗрдХреЛ рдореВрд▓ рджрд╕реНрддрд╛рд╡реЗрдЬрд▓рд╛рдИ рдкреНрд░рд╛рдзрд┐рдХреГрдд рд╕реНрд░реЛрдд рдорд╛рдирд┐рдиреБрдкрд░реНрдЫред рдорд╣рддреНрд╡рдкреВрд░реНрдг рдЬрд╛рдирдХрд╛рд░реАрдХреЛ рд▓рд╛рдЧрд┐, рд╡реНрдпрд╛рд╡рд╕рд╛рдпрд┐рдХ рдорд╛рдирд╡ рдЕрдиреБрд╡рд╛рдж рд╕рд┐рдлрд╛рд░рд┐рд╕ рдЧрд░рд┐рдиреНрдЫред рдпреЛ рдЕрдиреБрд╡рд╛рджрдХреЛ рдкреНрд░рдпреЛрдЧрдмрд╛рдЯ рдЙрддреНрдкрдиреНрди рд╣реБрдиреЗ рдХреБрдиреИ рдкрдирд┐ рдЧрд▓рддрдлрд╣рдореА рд╡рд╛ рдЧрд▓рдд рд╡реНрдпрд╛рдЦреНрдпрд╛рдХрд╛ рд▓рд╛рдЧрд┐ рд╣рд╛рдореА рдЬрд┐рдореНрдореЗрд╡рд╛рд░ рд╣реБрдиреЗ рдЫреИрдиреМрдВред