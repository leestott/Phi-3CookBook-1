# آموزش مدل Phi3 با استفاده از Olive

در این مثال، شما از Olive برای انجام موارد زیر استفاده خواهید کرد:

1. آموزش یک آداپتور LoRA برای طبقه‌بندی عبارات به چهار دسته: غم، شادی، ترس، شگفتی.
2. ادغام وزن‌های آداپتور با مدل پایه.
3. بهینه‌سازی و کمینه‌سازی مدل به `int4`.

همچنین، نحوه استنتاج مدل آموزش‌دیده با استفاده از API تولید ONNX Runtime (ORT) را به شما نشان خواهیم داد.

> **⚠️ برای آموزش، به یک GPU مناسب نیاز خواهید داشت - برای مثال، A10، V100، A100.**

## 💾 نصب

یک محیط مجازی جدید پایتون ایجاد کنید (برای مثال، با استفاده از `conda`):

```bash
conda create -n olive-ai python=3.11
conda activate olive-ai
```

سپس، Olive و وابستگی‌های لازم برای یک جریان کاری آموزش را نصب کنید:

```bash
cd Phi-3CookBook/code/04.Finetuning/olive-ort-example
pip install olive-ai[gpu]
pip install -r requirements.txt
```

## 🧪 آموزش Phi3 با استفاده از Olive

[فایل پیکربندی Olive](../../../../../code/04.Finetuning/olive-ort-example/phrase-classification.json) شامل یک *جریان کاری* با مراحل زیر است:

Phi3 -> LoRA -> MergeAdapterWeights -> ModelBuilder

در سطح کلی، این جریان کاری موارد زیر را انجام می‌دهد:

1. آموزش مدل Phi3 (برای 150 مرحله که می‌توانید آن را تغییر دهید) با استفاده از داده‌های [dataset/data-classification.json](../../../../../code/04.Finetuning/olive-ort-example/dataset/dataset-classification.json).
2. ادغام وزن‌های آداپتور LoRA با مدل پایه. این کار یک اثر مصنوعی مدل در فرمت ONNX به شما می‌دهد.
3. Model Builder مدل را برای اجرای ONNX بهینه‌سازی کرده و مدل را به `int4` کمینه‌سازی می‌کند.

برای اجرای این جریان کاری، دستور زیر را اجرا کنید:

```bash
olive run --config phrase-classification.json
```

پس از اتمام کار Olive، مدل Phi3 آموزش‌دیده و بهینه‌شده `int4` شما در مسیر زیر در دسترس خواهد بود:  
`code/04.Finetuning/olive-ort-example/models/lora-merge-mb/gpu-cuda_model`.

## 🧑‍💻 ادغام Phi3 آموزش‌دیده در برنامه شما

برای اجرای برنامه:

```bash
python app/app.py --phrase "cricket is a wonderful sport!" --model-path models/lora-merge-mb/gpu-cuda_model
```

پاسخ باید یک کلمه باشد که طبقه‌بندی عبارت را مشخص کند (غم/شادی/ترس/شگفتی).

**سلب مسئولیت**:  
این سند با استفاده از خدمات ترجمه ماشینی مبتنی بر هوش مصنوعی ترجمه شده است. در حالی که ما برای دقت تلاش می‌کنیم، لطفاً توجه داشته باشید که ترجمه‌های خودکار ممکن است حاوی خطاها یا نادرستی‌هایی باشند. سند اصلی به زبان اصلی آن باید به عنوان منبع معتبر در نظر گرفته شود. برای اطلاعات حیاتی، ترجمه حرفه‌ای انسانی توصیه می‌شود. ما هیچ مسئولیتی در قبال سوءتفاهم‌ها یا تفسیرهای نادرست ناشی از استفاده از این ترجمه نداریم.