このデモでは、事前学習済みモデルを使用して、画像とテキストプロンプトに基づいてPythonコードを生成する方法を紹介します。

[サンプルコード](../../../../../../code/06.E2E/E2E_OpenVino_Phi3-vision.ipynb)

以下は手順の説明です：

1. **インポートとセットアップ**:
   - 必要なライブラリやモジュールをインポートします。`requests`、`PIL`は画像処理用、`transformers`はモデルの処理や管理用に使用されます。

2. **画像の読み込みと表示**:
   - 画像ファイル (`demo.png`) を`PIL`ライブラリを使って開き、表示します。

3. **プロンプトの定義**:
   - 画像と、画像を処理して保存するためのPythonコードを生成するリクエストを含むメッセージを作成します。この処理には`plt`（matplotlib）が使われます。

4. **プロセッサの読み込み**:
   - 事前学習済みモデルから`AutoProcessor`を`out_dir`ディレクトリを指定して読み込みます。このプロセッサはテキストと画像の入力を処理します。

5. **プロンプトの作成**:
   - `apply_chat_template`メソッドを使用して、メッセージをモデルに適したプロンプト形式にフォーマットします。

6. **入力の処理**:
   - プロンプトと画像をモデルが理解できるテンソル形式に変換します。

7. **生成引数の設定**:
   - モデルの生成プロセスに使用する引数を定義します。これには、新しいトークンを生成する最大数や、出力をサンプリングするかどうかが含まれます。

8. **コードの生成**:
   - モデルが入力と生成引数に基づいてPythonコードを生成します。`TextStreamer`を使用して出力を処理し、プロンプトや特殊トークンをスキップします。

9. **出力**:
   - 生成されたコードが出力されます。このコードには、画像を処理して指定された方法で保存するPythonコードが含まれるはずです。

このデモは、OpenVinoを活用して事前学習済みモデルを使用し、ユーザーの入力や画像に基づいて動的にコードを生成する方法を示しています。

**免責事項**:  
この文書は、機械翻訳AIサービスを使用して翻訳されています。正確性を追求しておりますが、自動翻訳には誤りや不正確な部分が含まれる可能性があります。元の言語で記載された原文が公式な情報源とみなされるべきです。重要な情報については、専門の人間による翻訳をお勧めします。本翻訳の利用に起因する誤解や誤訳について、当方は一切の責任を負いかねます。