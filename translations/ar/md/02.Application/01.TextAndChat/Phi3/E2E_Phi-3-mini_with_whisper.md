# شات بوت تفاعلي Phi 3 Mini 4K مع Whisper

## نظرة عامة

شات بوت Phi 3 Mini 4K التفاعلي هو أداة تتيح للمستخدمين التفاعل مع عرض Microsoft Phi 3 Mini 4K التعليمي باستخدام إدخال نصي أو صوتي. يمكن استخدام الشات بوت لمجموعة متنوعة من المهام مثل الترجمة، تحديثات الطقس، وجمع المعلومات العامة.

### كيفية البدء

لاستخدام هذا الشات بوت، قم باتباع الخطوات التالية:

1. افتح [E2E_Phi-3-mini-4k-instruct-Whispser_Demo.ipynb](https://github.com/microsoft/Phi-3CookBook/blob/main/code/06.E2E/E2E_Phi-3-mini-4k-instruct-Whispser_Demo.ipynb)
2. في نافذة الدفتر الرئيسية، سترى واجهة دردشة تحتوي على صندوق إدخال نص وزر "إرسال".
3. لاستخدام الشات بوت النصي، اكتب رسالتك في صندوق الإدخال النصي واضغط على زر "إرسال". سيرد الشات بوت بملف صوتي يمكن تشغيله مباشرة من داخل الدفتر.

**ملاحظة**: تتطلب هذه الأداة وحدة معالجة رسومات (GPU) والوصول إلى نماذج Microsoft Phi-3 وOpenAI Whisper، والتي تُستخدم للتعرف على الكلام والترجمة.

### متطلبات GPU

لتشغيل هذا العرض، تحتاج إلى ذاكرة GPU بسعة 12 جيجابايت.

تعتمد متطلبات الذاكرة لتشغيل عرض **Microsoft-Phi-3-Mini-4K instruct** على GPU على عدة عوامل، مثل حجم البيانات المدخلة (صوت أو نص)، اللغة المستخدمة في الترجمة، سرعة النموذج، والذاكرة المتوفرة على الـ GPU.

بشكل عام، تم تصميم نموذج Whisper للعمل على وحدات معالجة الرسومات (GPUs). الحد الأدنى الموصى به من ذاكرة GPU لتشغيل نموذج Whisper هو 8 جيجابايت، ولكنه يمكن أن يتعامل مع كميات أكبر من الذاكرة إذا لزم الأمر.

من المهم ملاحظة أن تشغيل كميات كبيرة من البيانات أو عدد كبير من الطلبات على النموذج قد يتطلب ذاكرة GPU أكبر و/أو قد يسبب مشاكل في الأداء. يُوصى باختبار حالتك باستخدام تكوينات مختلفة ومراقبة استخدام الذاكرة لتحديد الإعدادات المثلى لاحتياجاتك.

## مثال E2E لشات بوت Phi 3 Mini 4K التفاعلي مع Whisper

دفتر Jupyter بعنوان [Interactive Phi 3 Mini 4K Instruct Chatbot with Whisper](https://github.com/microsoft/Phi-3CookBook/blob/main/code/06.E2E/E2E_Phi-3-mini-4k-instruct-Whispser_Demo.ipynb) يوضح كيفية استخدام عرض Microsoft Phi 3 Mini 4K التعليمي لإنشاء نص من إدخال صوتي أو نص مكتوب. يعرف الدفتر عدة وظائف:

1. `tts_file_name(text)`: تُنشئ هذه الوظيفة اسم ملف بناءً على النص المدخل لحفظ الملف الصوتي الناتج.
2. `edge_free_tts(chunks_list,speed,voice_name,save_path)`: تستخدم هذه الوظيفة واجهة Edge TTS API لإنشاء ملف صوتي من قائمة مقاطع النصوص المدخلة. المعاملات المدخلة هي قائمة المقاطع، سرعة الكلام، اسم الصوت، ومسار الإخراج لحفظ الملف الصوتي الناتج.
3. `talk(input_text)`: تُنشئ هذه الوظيفة ملفًا صوتيًا باستخدام واجهة Edge TTS API وحفظه باسم ملف عشوائي في دليل /content/audio. المعامل المدخل هو النص المراد تحويله إلى كلام.
4. `run_text_prompt(message, chat_history)`: تستخدم هذه الوظيفة عرض Microsoft Phi 3 Mini 4K التعليمي لإنشاء ملف صوتي من رسالة مدخلة وإضافته إلى سجل الدردشة.
5. `run_audio_prompt(audio, chat_history)`: تُحوِّل هذه الوظيفة ملفًا صوتيًا إلى نص باستخدام واجهة Whisper model API وتمريره إلى الوظيفة `run_text_prompt()`.
6. يطلق الكود تطبيق Gradio الذي يسمح للمستخدمين بالتفاعل مع عرض Phi 3 Mini 4K التعليمي إما عن طريق كتابة الرسائل أو تحميل الملفات الصوتية. يتم عرض المخرجات كرسالة نصية داخل التطبيق.

## استكشاف الأخطاء وإصلاحها

تثبيت تعريفات GPU الخاصة بـ Cuda

1. تأكد من تحديث تطبيقات Linux لديك

    ```bash
    sudo apt update
    ```

1. قم بتثبيت تعريفات Cuda

    ```bash
    sudo apt install nvidia-cuda-toolkit
    ```

1. قم بتسجيل موقع تعريف Cuda

    ```bash
    echo /usr/lib64-nvidia/ >/etc/ld.so.conf.d/libcuda.conf; ldconfig
    ```

1. التحقق من حجم ذاكرة Nvidia GPU (مطلوب 12 جيجابايت من ذاكرة GPU)

    ```bash
    nvidia-smi
    ```

1. تفريغ ذاكرة التخزين المؤقت: إذا كنت تستخدم PyTorch، يمكنك استدعاء torch.cuda.empty_cache() لتحرير جميع الذاكرة المؤقتة غير المستخدمة بحيث يمكن استخدامها بواسطة تطبيقات GPU الأخرى.

    ```python
    torch.cuda.empty_cache() 
    ```

1. التحقق من Cuda الخاصة بـ Nvidia

    ```bash
    nvcc --version
    ```

1. قم بتنفيذ الخطوات التالية لإنشاء رمز Hugging Face.

    - انتقل إلى [صفحة إعدادات رمز Hugging Face](https://huggingface.co/settings/tokens?WT.mc_id=aiml-137032-kinfeylo).
    - اختر **رمز جديد**.
    - أدخل **اسم المشروع** الذي تريد استخدامه.
    - اختر **النوع** ليكون **كتابة**.

> **ملاحظة**
>
> إذا واجهت الخطأ التالي:
>
> ```bash
> /sbin/ldconfig.real: Can't create temporary cache file /etc/ld.so.cache~: Permission denied 
> ```
>
> لحل هذه المشكلة، اكتب الأمر التالي داخل الطرفية:
>
> ```bash
> sudo ldconfig
> ```

**إخلاء المسؤولية**:  
تمت ترجمة هذا المستند باستخدام خدمات الترجمة الآلية القائمة على الذكاء الاصطناعي. بينما نسعى لتحقيق الدقة، يُرجى العلم أن الترجمات الآلية قد تحتوي على أخطاء أو معلومات غير دقيقة. يجب اعتبار المستند الأصلي بلغته الأصلية هو المصدر الموثوق. للحصول على معلومات حساسة أو هامة، يُوصى بالاستعانة بترجمة بشرية احترافية. نحن غير مسؤولين عن أي سوء فهم أو تفسيرات خاطئة تنشأ عن استخدام هذه الترجمة.