# **Microsoft Phi-3.5 tflite рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ Android рдРрдк рдмрдирд╛рдирд╛**

рдпрд╣ Microsoft Phi-3.5 tflite рдореЙрдбрд▓реНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдПрдХ Android рд╕реИрдВрдкрд▓ рд╣реИред

## **ЁЯУЪ рдЬреНрдЮрд╛рди**

Android LLM Inference API рдЖрдкрдХреЛ Android рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рд▓рд┐рдП рдмрдбрд╝реЗ рднрд╛рд╖рд╛ рдореЙрдбрд▓реНрд╕ (LLMs) рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдСрди-рдбрд┐рд╡рд╛рдЗрд╕ рдЪрд▓рд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЖрдк рдХрдИ рдкреНрд░рдХрд╛рд░ рдХреЗ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ рдЯреЗрдХреНрд╕реНрдЯ рдЬрдирд░реЗрдЯ рдХрд░рдирд╛, рдкреНрд░рд╛рдХреГрддрд┐рдХ рднрд╛рд╖рд╛ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдФрд░ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реЛрдВ рдХрд╛ рд╕рд╛рд░рд╛рдВрд╢ рдмрдирд╛рдирд╛ред рдпрд╣ рдЯрд╛рд╕реНрдХ рдХрдИ рдЯреЗрдХреНрд╕реНрдЯ-рдЯреВ-рдЯреЗрдХреНрд╕реНрдЯ рдмрдбрд╝реЗ рднрд╛рд╖рд╛ рдореЙрдбрд▓реНрд╕ рдХреЗ рд▓рд┐рдП рдмрд┐рд▓реНрдЯ-рдЗрди рд╕рдкреЛрд░реНрдЯ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЖрдк рдирд╡реАрдирддрдо рдСрди-рдбрд┐рд╡рд╛рдЗрд╕ рдЬрдирд░реЗрдЯрд┐рд╡ рдПрдЖрдИ рдореЙрдбрд▓реНрд╕ рдХреЛ рдЕрдкрдиреЗ Android рдРрдкреНрд╕ рдореЗрдВ рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

Google AI Edge Torch рдПрдХ рдкрд╛рдпрдерди рд▓рд╛рдЗрдмреНрд░реЗрд░реА рд╣реИ рдЬреЛ PyTorch рдореЙрдбрд▓реНрд╕ рдХреЛ .tflite рдлреЙрд░реНрдореЗрдЯ рдореЗрдВ рдмрджрд▓рдиреЗ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддреА рд╣реИред рдЗрд╕реЗ рдлрд┐рд░ TensorFlow Lite рдФрд░ MediaPipe рдХреЗ рд╕рд╛рде рдЪрд▓рд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ Android, iOS рдФрд░ IoT рдХреЗ рд▓рд┐рдП рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕рдХреНрд╖рдо рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдореЙрдбрд▓реНрд╕ рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдСрди-рдбрд┐рд╡рд╛рдЗрд╕ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВред AI Edge Torch рд╡реНрдпрд╛рдкрдХ CPU рдХрд╡рд░реЗрдЬ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рдФрд░ рд╢реБрд░реБрдЖрддреА GPU рдФрд░ NPU рд╕рдкреЛрд░реНрдЯ рдХреЗ рд╕рд╛рде рдЖрддрд╛ рд╣реИред AI Edge Torch PyTorch рдХреЗ рд╕рд╛рде рдЧрд╣рд░рд╛рдИ рд╕реЗ рдПрдХреАрдХреГрдд рд╣реЛрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИ, torch.export() рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИ рдФрд░ Core ATen рдСрдкрд░реЗрдЯрд░реНрд╕ рдХреА рдЕрдЪреНрдЫреА рдХрд╡рд░реЗрдЬ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред

## **ЁЯкм рджрд┐рд╢рд╛рдирд┐рд░реНрджреЗрд╢**

### **ЁЯФе Microsoft Phi-3.5 рдХреЛ tflite рд╕рдкреЛрд░реНрдЯ рдореЗрдВ рдмрджрд▓рдирд╛**

0. рдпрд╣ рд╕реИрдВрдкрд▓ Android 14+ рдХреЗ рд▓рд┐рдП рд╣реИ

1. Python 3.10.12 рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░реЗрдВ

***рд╕реБрдЭрд╛рд╡:*** рдЕрдкрдиреЗ Python рдПрдиреНрд╡рд╛рдпрд░рдирдореЗрдВрдЯ рдХреЛ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП conda рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ

2. Ubuntu 20.04 / 22.04 (рдХреГрдкрдпрд╛ [google ai-edge-torch](https://github.com/google-ai-edge/ai-edge-torch) рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рдХрд░реЗрдВ)

***рд╕реБрдЭрд╛рд╡:*** Azure Linux VM рдпрд╛ рдХрд┐рд╕реА 3rd рдкрд╛рд░реНрдЯреА рдХреНрд▓рд╛рдЙрдб VM рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдкрдирд╛ рдПрдиреНрд╡рд╛рдпрд░рдирдореЗрдВрдЯ рдмрдирд╛рдПрдВ

3. рдЕрдкрдиреЗ Linux bash рдкрд░ рдЬрд╛рдПрдВ рдФрд░ Python рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░реЗрдВ

```bash

git clone https://github.com/google-ai-edge/ai-edge-torch.git

cd ai-edge-torch

pip install -r requirements.txt -U 

pip install tensorflow-cpu -U

pip install -e .

```

4. Hugging Face рд╕реЗ Microsoft-3.5-Instruct рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ

```bash

git lfs install

git clone  https://huggingface.co/microsoft/Phi-3.5-mini-instruct

```

5. Microsoft Phi-3.5 рдХреЛ tflite рдореЗрдВ рдмрджрд▓реЗрдВ

```bash

python ai-edge-torch/ai_edge_torch/generative/examples/phi/convert_phi3_to_tflite.py --checkpoint_path  Your Microsoft Phi-3.5-mini-instruct path --tflite_path Your Microsoft Phi-3.5-mini-instruct tflite path  --prefill_seq_len 1024 --kv_cache_max_len 1280 --quantize True

```

### **ЁЯФе Microsoft Phi-3.5 рдХреЛ Android Mediapipe Bundle рдореЗрдВ рдмрджрд▓рдирд╛**

рдХреГрдкрдпрд╛ рдкрд╣рд▓реЗ mediapipe рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░реЗрдВ

```bash

pip install mediapipe

```

рдЗрд╕ рдХреЛрдб рдХреЛ [рдЕрдкрдиреЗ рдиреЛрдЯрдмреБрдХ](../../../../../../code/09.UpdateSamples/Aug/Android/convert/convert_phi.ipynb) рдореЗрдВ рдЪрд▓рд╛рдПрдВ

```python

import mediapipe as mp
from mediapipe.tasks.python.genai import bundler

config = bundler.BundleConfig(
    tflite_model='Your Phi-3.5 tflite model path',
    tokenizer_model='Your Phi-3.5 tokenizer model path',
    start_token='start_token',
    stop_tokens=[STOP_TOKENS],
    output_filename='Your Phi-3.5 task model path',
    enable_bytes_to_unicode_mapping=True or Flase,
)
bundler.create_bundle(config)

```

### **ЁЯФе adb push рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдореЙрдбрд▓ рдХреЛ рдЕрдкрдиреЗ Android рдбрд┐рд╡рд╛рдЗрд╕ рдХреЗ рдкрд╛рде рдкрд░ рднреЗрдЬреЗрдВ**

```bash

adb shell rm -r /data/local/tmp/llm/ # Remove any previously loaded models

adb shell mkdir -p /data/local/tmp/llm/

adb push 'Your Phi-3.5 task model path' /data/local/tmp/llm/phi3.task

```

### **ЁЯФе рдЕрдкрдирд╛ Android рдХреЛрдб рдЪрд▓рд╛рдПрдВ**

![demo](../../../../../../translated_images/demo.8981711efb5a9cee5dcd835f66b3b31b94b4f3e527300e15a98a0d48863b9fbd.hi.png)

**рдЕрд╕реНрд╡реАрдХрд░рдг**:  
рдпрд╣ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдорд╢реАрди-рдЖрдзрд╛рд░рд┐рдд рдПрдЖрдИ рдЕрдиреБрд╡рд╛рдж рд╕реЗрд╡рд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдиреБрд╡рд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдЬрдмрдХрд┐ рд╣рдо рд╕рдЯреАрдХрддрд╛ рдХреЗ рд▓рд┐рдП рдкреНрд░рдпрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ, рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЕрдиреБрд╡рд╛рджреЛрдВ рдореЗрдВ рддреНрд░реБрдЯрд┐рдпрд╛рдБ рдпрд╛ рдЕрд╢реБрджреНрдзрд┐рдпрд╛рдБ рд╣реЛ рд╕рдХрддреА рд╣реИрдВред рдореВрд▓ рднрд╛рд╖рд╛ рдореЗрдВ рдЙрдкрд▓рдмреНрдз рдореВрд▓ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдХреЛ рдкреНрд░рд╛рдорд╛рдгрд┐рдХ рд╕реНрд░реЛрдд рдорд╛рдирд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред рдорд╣рддреНрд╡рдкреВрд░реНрдг рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП, рдкреЗрд╢реЗрд╡рд░ рдорд╛рдирд╡ рдЕрдиреБрд╡рд╛рдж рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХреА рдЬрд╛рддреА рд╣реИред рдЗрд╕ рдЕрдиреБрд╡рд╛рдж рдХреЗ рдЙрдкрдпреЛрдЧ рд╕реЗ рдЙрддреНрдкрдиреНрди рдХрд┐рд╕реА рднреА рдЧрд▓рддрдлрд╣рдореА рдпрд╛ рдЧрд▓рдд рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХреЗ рд▓рд┐рдП рд╣рдо рдЙрддреНрддрд░рджрд╛рдпреА рдирд╣реАрдВ рд╣реИрдВред