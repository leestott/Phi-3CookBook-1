# Olive рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ Phi3 рдХреЛ рдлрд╛рдЗрди-рдЯреНрдпреВрди рдХрд░реЗрдВ

рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рдЖрдк Olive рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд░реЗрдВрдЧреЗ:

1. рдПрдХ LoRA рдПрдбреЗрдкреНрдЯрд░ рдХреЛ рдлрд╛рдЗрди-рдЯреНрдпреВрди рдХрд░реЗрдВ рддрд╛рдХрд┐ рд╡рд╛рдХреНрдпреЛрдВ рдХреЛ Sad, Joy, Fear, Surprise рдореЗрдВ рд╡рд░реНрдЧреАрдХреГрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред
2. рдПрдбреЗрдкреНрдЯрд░ рд╡реЗрдЯреНрд╕ рдХреЛ рдмреЗрд╕ рдореЙрдбрд▓ рдореЗрдВ рдорд░реНрдЬ рдХрд░реЗрдВред
3. рдореЙрдбрд▓ рдХреЛ `int4` рдореЗрдВ рдСрдкреНрдЯрд┐рдорд╛рдЗрдЬрд╝ рдФрд░ рдХреНрд╡рд╛рдВрдЯрд╛рдЗрдЬрд╝ рдХрд░реЗрдВред

рд╣рдо рдЖрдкрдХреЛ рдпрд╣ рднреА рджрд┐рдЦрд╛рдПрдВрдЧреЗ рдХрд┐ ONNX Runtime (ORT) Generate API рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдлрд╛рдЗрди-рдЯреНрдпреВрди рдХрд┐рдП рдЧрдП рдореЙрдбрд▓ рдкрд░ рдЗрдиреНрдлрд░реЗрдВрд╕ рдХреИрд╕реЗ рдХрд░реЗрдВред

> **тЪая╕П рдлрд╛рдЗрди-рдЯреНрдпреВрдирд┐рдВрдЧ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ рдЙрдкрдпреБрдХреНрдд GPU рдЙрдкрд▓рдмреНрдз рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП - рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, A10, V100, A100ред**

## ЁЯТ╛ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░реЗрдВ

рдПрдХ рдирдпрд╛ Python рд╡рд░реНрдЪреБрдЕрд▓ рдПрдирд╡рд╛рдпрд░рдирдореЗрдВрдЯ рдмрдирд╛рдПрдВ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, `conda` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ):

```bash
conda create -n olive-ai python=3.11
conda activate olive-ai
```

рдЗрд╕рдХреЗ рдмрд╛рдж, Olive рдФрд░ рдлрд╛рдЗрди-рдЯреНрдпреВрдирд┐рдВрдЧ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдбрд┐рдкреЗрдВрдбреЗрдВрд╕реАрдЬрд╝ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░реЗрдВ:

```bash
cd Phi-3CookBook/code/04.Finetuning/olive-ort-example
pip install olive-ai[gpu]
pip install -r requirements.txt
```

## ЁЯзк Olive рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ Phi3 рдХреЛ рдлрд╛рдЗрди-рдЯреНрдпреВрди рдХрд░реЗрдВ
[Olive рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╛рдЗрд▓](../../../../../code/04.Finetuning/olive-ort-example/phrase-classification.json) рдореЗрдВ рдПрдХ *рд╡рд░реНрдХрдлрд╝реНрд▓реЛ* рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд *рдкрд╛рд╕* рд╢рд╛рдорд┐рд▓ рд╣реИрдВ:

Phi3 -> LoRA -> MergeAdapterWeights -> ModelBuilder

рдЙрдЪреНрдЪ рд╕реНрддрд░ рдкрд░, рдпрд╣ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд░реЗрдЧрд╛:

1. Phi3 рдХреЛ [dataset/data-classification.json](../../../../../code/04.Finetuning/olive-ort-example/dataset/dataset-classification.json) рдбреЗрдЯрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдлрд╛рдЗрди-рдЯреНрдпреВрди рдХрд░реЗрдВ (150 рд╕реНрдЯреЗрдкреНрд╕ рдХреЗ рд▓рд┐рдП, рдЬрд┐рд╕реЗ рдЖрдк рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ)ред
2. LoRA рдПрдбреЗрдкреНрдЯрд░ рд╡реЗрдЯреНрд╕ рдХреЛ рдмреЗрд╕ рдореЙрдбрд▓ рдореЗрдВ рдорд░реНрдЬ рдХрд░реЗрдВред рдЗрд╕рд╕реЗ рдЖрдкрдХреЛ ONNX рдлреЙрд░реНрдореЗрдЯ рдореЗрдВ рдПрдХ рд╕рд┐рдВрдЧрд▓ рдореЙрдбрд▓ рдЖрд░реНрдЯрд┐рдлреИрдХреНрдЯ рдорд┐рд▓реЗрдЧрд╛ред
3. Model Builder рдореЙрдбрд▓ рдХреЛ ONNX рд░рдирдЯрд╛рдЗрдо рдХреЗ рд▓рд┐рдП рдСрдкреНрдЯрд┐рдорд╛рдЗрдЬрд╝ рдХрд░реЗрдЧрд╛ *рдФрд░* рдореЙрдбрд▓ рдХреЛ `int4` рдореЗрдВ рдХреНрд╡рд╛рдВрдЯрд╛рдЗрдЬрд╝ рдХрд░реЗрдЧрд╛ред

рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ:

```bash
olive run --config phrase-classification.json
```

рдЬрдм Olive рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдкреВрд░реА рдХрд░ рд▓реЗрдЧрд╛, рддреЛ рдЖрдкрдХрд╛ рдСрдкреНрдЯрд┐рдорд╛рдЗрдЬрд╝реНрдб `int4` рдлрд╛рдЗрди-рдЯреНрдпреВрди рдХрд┐рдпрд╛ рд╣реБрдЖ Phi3 рдореЙрдбрд▓ рдпрд╣рд╛рдБ рдЙрдкрд▓рдмреНрдз рд╣реЛрдЧрд╛: `code/04.Finetuning/olive-ort-example/models/lora-merge-mb/gpu-cuda_model`ред

## ЁЯзСтАНЁЯТ╗ рдЕрдкрдиреЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдлрд╛рдЗрди-рдЯреНрдпреВрди рдХрд┐рдпрд╛ рд╣реБрдЖ Phi3 рдЗрдВрдЯреАрдЧреНрд░реЗрдЯ рдХрд░реЗрдВ 

рдРрдк рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП:

```bash
python app/app.py --phrase "cricket is a wonderful sport!" --model-path models/lora-merge-mb/gpu-cuda_model
```

рдпрд╣ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╡рд╛рдХреНрдп рдХрд╛ рдПрдХ рд╕рд┐рдВрдЧрд▓ рд╡рд░реНрдб рдХреНрд▓рд╛рд╕рд┐рдлрд┐рдХреЗрд╢рди рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП (Sad/Joy/Fear/Surprise)ред

**рдЕрд╕реНрд╡реАрдХрд░рдг**:  
рдпрд╣ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдорд╢реАрди-рдЖрдзрд╛рд░рд┐рдд рдПрдЖрдИ рдЕрдиреБрд╡рд╛рдж рд╕реЗрд╡рд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдиреБрд╡рд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдЬрдмрдХрд┐ рд╣рдо рд╕рдЯреАрдХрддрд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ, рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЕрдиреБрд╡рд╛рдж рдореЗрдВ рддреНрд░реБрдЯрд┐рдпрд╛рдВ рдпрд╛ рдЧрд▓рддрд┐рдпрд╛рдВ рд╣реЛ рд╕рдХрддреА рд╣реИрдВред рдореВрд▓ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝, рдЬреЛ рдЗрд╕рдХреА рдореВрд▓ рднрд╛рд╖рд╛ рдореЗрдВ рд╣реИ, рдХреЛ рдкреНрд░рд╛рдорд╛рдгрд┐рдХ рд╕реНрд░реЛрдд рдорд╛рдирд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред рдорд╣рддреНрд╡рдкреВрд░реНрдг рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП, рдкреЗрд╢реЗрд╡рд░ рдорд╛рдирд╡ рдЕрдиреБрд╡рд╛рдж рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХреА рдЬрд╛рддреА рд╣реИред рдЗрд╕ рдЕрдиреБрд╡рд╛рдж рдХреЗ рдЙрдкрдпреЛрдЧ рд╕реЗ рдЙрддреНрдкрдиреНрди рдХрд┐рд╕реА рднреА рдЧрд▓рддрдлрд╣рдореА рдпрд╛ рдЧрд▓рдд рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХреЗ рд▓рд┐рдП рд╣рдо рдЙрддреНрддрд░рджрд╛рдпреА рдирд╣реАрдВ рд╣реИрдВред